!function e(t,i,n){function r(l,s){if(!i[l]){if(!t[l]){var a="function"==typeof require&&require;if(!s&&a)return a(l,!0);if(o)return o(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var u=i[l]={exports:{}};t[l][0].call(u.exports,function(e){var i=t[l][1][e];return r(i||e)},u,u.exports,e,t,i,n)}return i[l].exports}for(var o="function"==typeof require&&require,l=0;l<n.length;l++)r(n[l]);return r}({1:[function(e,t,i){var n;n=Marionette.Behavior.extend({onChildviewClickNew:function(e){var t=e.$el.index()+1;this.addChild({at:t})},onRequestNew:function(){this.addChild()},addChild:function(e){if(!this.view.isCollectionFilled()){e=e||{};var t={id:qazana.helpers.getUniqueID(),elType:this.view.getChildType()[0],settings:{},elements:[]};this.view.addChildModel(t,e)}}}),t.exports=n},{}],2:[function(e,t,i){var n;n=Marionette.Behavior.extend({config:{class:"qazana-section-tools-active"},initialize:function(){this.listenTo(qazana.channels.dataEditMode,"switch",this.onEditModeSwitched)},onEditModeSwitched:function(){var e=qazana.channels.dataEditMode.request("activeMode");this.view.$el.removeClass(this.config.class,"edit"===e)},handleSectionHover:function(){var e=this,t={sensitivity:1,interval:10,timeout:500,over:function(){e.view.$el.addClass(e.config.class)},out:function(){e.view.$el.removeClass(e.config.class)}};e.view.$el.hoverIntent(t)},onRender:function(){this.onEditModeSwitched(),this.handleSectionHover()}}),t.exports=n},{}],3:[function(e,t,i){var n;n=Marionette.Behavior.extend({onChildviewRequestDuplicate:function(e){if(!this.view.isCollectionFilled()){var t=this.view.collection.indexOf(e.model),i=e.model.clone();this.view.addChildModel(i,{at:t+1})}}}),t.exports=n},{}],4:[function(e,t,i){var n;n=Marionette.Behavior.extend({onRender:function(){this.handleInnerTabs(this.view)},handleInnerTabs:function(e){var t=e.children.filter(function(e){return"tabs"===e.model.get("type")});_.each(t,function(t){t.$el.find(".qazana-control-content").remove();var i=t.model.get("name"),n=e.children.filter(function(e){return"tab"===e.model.get("type")&&e.model.get("tabs_wrapper")===i});_.each(n,function(i,n){t._addChildView(i);var r=i.model.get("name"),o=e.children.filter(function(e){return r===e.model.get("inner_tab")});0===n?i.$el.addClass("qazana-tab-active"):_.each(o,function(e){e.$el.addClass("qazana-tab-close")})})})},onChildviewControlTabClicked:function(e){var t=e.model.get("name"),i=this.view.children.filter(function(t){return"tab"!==t.model.get("type")&&e.model.get("tabs_wrapper")===t.model.get("tabs_wrapper")}),n=this.view.children.filter(function(t){return"tab"===t.model.get("type")&&e.model.get("tabs_wrapper")===t.model.get("tabs_wrapper")});_.each(n,function(e){e.$el.removeClass("qazana-tab-active")}),e.$el.addClass("qazana-tab-active"),_.each(i,function(e){e.model.get("inner_tab")===t?e.$el.removeClass("qazana-tab-close"):e.$el.addClass("qazana-tab-close")}),qazana.channels.data.trigger("scrollbar:update")}}),t.exports=n},{}],5:[function(e,t,i){var n;n=Marionette.Behavior.extend({defaults:{handles:qazana.config.is_rtl?"w":"e"},ui:{columnTitle:".column-title"},events:{resizestart:"onResizeStart",resizestop:"onResizeStop",resize:"onResize"},initialize:function(){Marionette.Behavior.prototype.initialize.apply(this,arguments),this.listenTo(qazana.channels.dataEditMode,"switch",this.onEditModeSwitched)},active:function(){var e=_.clone(this.options);delete e.behaviorClass;var t=this.getChildViewContainer(),i={},n=_.extend(i,e);t.resizable(n)},deactivate:function(){this.getChildViewContainer().resizable("instance")&&this.getChildViewContainer().resizable("destroy")},onEditModeSwitched:function(e){"edit"===e?this.active():this.deactivate()},onRender:function(){var e=this;_.defer(function(){e.onEditModeSwitched(qazana.channels.dataEditMode.request("activeMode"))})},onDestroy:function(){this.deactivate()},onResizeStart:function(e){e.stopPropagation(),this.view.triggerMethod("request:resize:start")},onResizeStop:function(e){e.stopPropagation(),this.view.triggerMethod("request:resize:stop")},onResize:function(e,t){e.stopPropagation(),this.view.triggerMethod("request:resize",t)},getChildViewContainer:function(){return this.$el}}),t.exports=n},{}],6:[function(e,t,i){var n;n=Marionette.Behavior.extend({defaults:{elChildType:"widget"},events:{sortstart:"onSortStart",sortreceive:"onSortReceive",sortupdate:"onSortUpdate",sortstop:"onSortStop",sortover:"onSortOver",sortout:"onSortOut"},initialize:function(){this.listenTo(qazana.channels.dataEditMode,"switch",this.onEditModeSwitched),this.listenTo(qazana.channels.deviceMode,"change",this.onDeviceModeChange)},onEditModeSwitched:function(e){"edit"===e?this.active():this.deactivate()},onDeviceModeChange:function(){"desktop"===qazana.channels.deviceMode.request("currentMode")?this.active():this.deactivate()},onRender:function(){var e=this;_.defer(function(){e.onEditModeSwitched(qazana.channels.dataEditMode.request("activeMode"))})},onDestroy:function(){this.deactivate()},active:function(){if(!this.getChildViewContainer().sortable("instance")){var e=this.getChildViewContainer(),t={connectWith:e.selector,cursor:"move",placeholder:"qazana-sortable-placeholder",cursorAt:{top:20,left:25},helper:_.bind(this._getSortableHelper,this)},i=_.extend(t,this.view.getSortableOptions());e.sortable(i)}},_getSortableHelper:function(e,t){var i=this.view.collection.get({cid:t.data("model-cid")});return'<div style="height: 84px; width: 125px;" class="qazana-sortable-helper qazana-sortable-helper-'+i.get("elType")+'"><div class="icon"><i class="'+i.getIcon()+'"></i></div><div class="qazana-element-title-wrapper"><div class="title">'+i.getTitle()+"</div></div></div>"},deactivate:function(){this.getChildViewContainer().sortable("instance")&&this.getChildViewContainer().sortable("destroy")},onSortStart:function(e,t){e.stopPropagation();var i=this.view.collection.get({cid:t.item.data("model-cid")});if("column"===this.options.elChildType){t.placeholder.addClass("qazana-column");var n=0;t.item.data("sortableItem").items.forEach(function(e){if(e.item[0]===t.item[0])return n=e.height,!1}),t.placeholder.height(n)}qazana.channels.data.trigger(i.get("elType")+":drag:start"),qazana.channels.data.reply("cache:"+i.cid,i)},onSortOver:function(e,t){e.stopPropagation();var i=qazana.channels.data.request("cache:"+t.item.data("model-cid"));Backbone.$(e.target).addClass("qazana-draggable-over").attr({"data-dragged-element":i.get("elType"),"data-dragged-is-inner":i.get("isInner")}),this.$el.addClass("qazana-dragging-on-child")},onSortOut:function(e){e.stopPropagation(),Backbone.$(e.target).removeClass("qazana-draggable-over").removeAttr("data-dragged-element data-dragged-is-inner"),this.$el.removeClass("qazana-dragging-on-child")},onSortReceive:function(e,t){if(e.stopPropagation(),this.view.isCollectionFilled())Backbone.$(t.sender).sortable("cancel");else{var i=qazana.channels.data.request("cache:"+t.item.data("model-cid")),n=i.get("elType"),r="section"===n&&i.get("isInner"),o="column"===this.view.getElementType()&&this.view.isInner();if(r&&o)Backbone.$(t.sender).sortable("cancel");else{var l=t.item.parent().children().index(t.item),s=new this.view.collection.model(i.toJSON({copyHtmlCache:!0}));this.view.addChildModel(s,{at:l}),qazana.channels.data.trigger(n+":drag:end"),i.destroy()}}},onSortUpdate:function(e,t){e.stopPropagation();var i=this.view.collection.get(t.item.attr("data-model-cid"));i&&qazana.channels.data.trigger(i.get("elType")+":drag:end")},onSortStop:function(e,t){e.stopPropagation();var i=t.item,n=this.view.collection,r=n.get(i.attr("data-model-cid")),o=i.parent().children().index(i);this.getChildViewContainer()[0]===t.item.parent()[0]&&null===t.sender&&r&&(n.indexOf(r)!==o&&(n.remove(r),this.view.addChildModel(r,{at:o}),qazana.setFlagEditorChange(!0)),qazana.channels.data.trigger(r.get("elType")+":drag:end"))},onAddChild:function(e){e.$el.attr("data-model-cid",e.model.cid)},getChildViewContainer:function(){return"function"==typeof this.view.getChildViewContainer?this.view.getChildViewContainer(this.view):this.$el}}),t.exports=n},{}],7:[function(e,t,i){var n=e("./model");t.exports=Backbone.Collection.extend({model:n})},{"./model":10}],8:[function(e,t,i){t.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-panel-revisions-no-revisions",id:"qazana-panel-revisions-no-revisions",className:"qazana-panel-nerd-box"})},{}],9:[function(e,t,i){var n,r=e("./collection"),o=e("./panel-page"),l=e("./empty-view");n=function(){var e,t=this,i=function(){qazana.getPanelView().addPage("revisionsPage",{getView:function(){return e.length?o:l},title:qazana.translate("revision_history"),options:{collection:e}})},n=function(i){i.last_revision&&t.addRevision(i.last_revision);var n=e.filter(function(e){return-1!==i.revisions_ids.indexOf(e.get("id"))});e.reset(n)},s=function(){qazana.channels.editor.on("saved",n)},a=function(){var e={isWorthHandling:function(){var e=qazana.getPanelView();if("revisionsPage"!==e.getCurrentPageName())return!1;var t=e.getCurrentPageView();return t.currentPreviewId&&t.currentPreviewItem&&t.children.length>1},handle:function(e){qazana.getPanelView().getCurrentPageView().navigate(38===e.which)}};qazana.hotKeys.addHotKeyHandler(38,"revisionNavigation",e),qazana.hotKeys.addHotKeyHandler(40,"revisionNavigation",e),qazana.hotKeys.addHotKeyHandler(72,"showRevisionsPage",{isWorthHandling:function(e){return qazana.hotKeys.isControlEvent(e)&&e.shiftKey},handle:function(){qazana.getPanelView().setPage("revisionsPage")}})};this.addRevision=function(t){e.add(t,{at:0});var i=qazana.getPanelView();i.getCurrentPageView()instanceof l&&i.setPage("revisionsPage")},this.deleteRevision=function(t,i){var n={data:{id:t.get("id")},success:function(){i.success&&i.success(),t.destroy(),e.length||qazana.getPanelView().setPage("revisionsPage")}};i.error&&(n.error=i.error),qazana.ajax.send("delete_revision",n)},this.init=function(){e=new r(qazana.config.revisions),s(),a(),qazana.on("preview:loaded",i)}},t.exports=new n},{"./collection":7,"./empty-view":8,"./panel-page":11}],10:[function(e,t,i){var n;(n=Backbone.Model.extend()).prototype.sync=function(){return null},t.exports=n},{}],11:[function(e,t,i){t.exports=Marionette.CompositeView.extend({id:"qazana-panel-revisions",template:"#tmpl-qazana-panel-revisions",childView:e("./view"),childViewContainer:"#qazana-revisions-list",ui:{discard:".qazana-panel-scheme-discard .qazana-button",apply:".qazana-panel-scheme-save .qazana-button"},events:{"click @ui.discard":"onDiscardClick","click @ui.apply":"onApplyClick"},isRevisionApplied:!1,jqueryXhr:null,currentPreviewId:null,currentPreviewItem:null,initialize:function(){this.listenTo(qazana.channels.editor,"saved",this.onEditorSaved)},getRevisionViewData:function(e){var t=this,i=e.model.get("id");t.jqueryXhr=qazana.ajax.send("get_revision_data",{data:{id:i},success:function(i){t.setEditorData(i),t.setRevisionsButtonsActive(!0),t.jqueryXhr=null,e.$el.removeClass("qazana-revision-item-loading"),t.enterReviewMode()},error:function(i){e.$el.removeClass("qazana-revision-item-loading"),"abort"!==t.jqueryXhr.statusText&&(t.currentPreviewItem=null,t.currentPreviewId=null,alert("An error occurred"))}})},setRevisionsButtonsActive:function(e){this.ui.apply.add(this.ui.discard).prop("disabled",!e)},setEditorData:function(e){qazana.getRegion("sections").currentView.collection.reset(e)},deleteRevision:function(e){var t=this;e.$el.addClass("qazana-revision-item-loading"),qazana.revisions.deleteRevision(e.model,{success:function(){e.model.get("id")===t.currentPreviewId&&t.onDiscardClick(),t.currentPreviewId=null},error:function(t){e.$el.removeClass("qazana-revision-item-loading"),alert("An error occurred")}})},enterReviewMode:function(){qazana.changeEditMode("review")},exitReviewMode:function(){qazana.changeEditMode("edit")},navigate:function(e){var t=this.collection.indexOf(this.currentPreviewItem.model),i=e?t-1:t+1;i<0&&(i=this.collection.length-1),i>=this.collection.length&&(i=0),this.children.findByIndex(i).ui.detailsArea.trigger("click")},onEditorSaved:function(){this.exitReviewMode(),this.setRevisionsButtonsActive(!1)},onApplyClick:function(){qazana.getPanelView().getChildView("footer")._publishQazana(),this.isRevisionApplied=!0,this.currentPreviewId=null},onDiscardClick:function(){this.setEditorData(qazana.config.data),qazana.setFlagEditorChange(this.isRevisionApplied),this.isRevisionApplied=!1,this.setRevisionsButtonsActive(!1),this.currentPreviewId=null,this.exitReviewMode(),this.currentPreviewItem&&this.currentPreviewItem.$el.removeClass("qazana-revision-current-preview")},onDestroy:function(){this.currentPreviewId&&this.onDiscardClick()},onRenderCollection:function(){if(this.currentPreviewId){var e=this.collection.findWhere({id:this.currentPreviewId});this.currentPreviewItem=this.children.findByModelCid(e.cid),this.currentPreviewItem.$el.addClass("qazana-revision-current-preview")}},onChildviewDetailsAreaClick:function(e){var t=this,i=e.model.get("id");i!==t.currentPreviewId&&(this.jqueryXhr&&this.jqueryXhr.abort(),t.currentPreviewItem&&t.currentPreviewItem.$el.removeClass("qazana-revision-current-preview"),e.$el.addClass("qazana-revision-current-preview qazana-revision-item-loading"),qazana.isEditorChanged()&&null===t.currentPreviewId?qazana.saveEditor({status:"autosave",save_state:"save",onSuccess:function(){t.getRevisionViewData(e)}}):t.getRevisionViewData(e),t.currentPreviewItem=e,t.currentPreviewId=i)},onChildviewDeleteClick:function(e){var t=this,i=e.model.get("type");e.model.get("id");qazana.dialogsManager.createWidget("confirm",{message:qazana.translate("dialog_confirm_delete",[i]),headerMessage:qazana.translate("delete_element",[i]),strings:{confirm:qazana.translate("delete"),cancel:qazana.translate("cancel")},defaultOption:"confirm",onConfirm:function(){t.deleteRevision(e)}}).show()}})},{"./view":12}],12:[function(e,t,i){t.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-panel-revisions-revision-item",className:"qazana-revision-item",ui:{detailsArea:".qazana-revision-item__details",deleteButton:".qazana-revision-item__tools-delete"},triggers:{"click @ui.detailsArea":"detailsArea:click","click @ui.deleteButton":"delete:click"}})},{}],13:[function(e,t,i){var n,r=e("qazana-templates/models/template");n=Backbone.Collection.extend({model:r}),t.exports=n},{"qazana-templates/models/template":15}],14:[function(e,t,i){var n,r=e("qazana-templates/views/layout"),o=e("qazana-templates/collections/templates");n=function(){var e,t,i,n,l,s=this,a={},d=function(){n=new r},u=function(){var e={saveDialog:{description:qazana.translate("save_your_template_description")},ajaxParams:{success:function(e){s.getTemplatesCollection().add(e),s.setTemplatesSource("local"),s.showTemplates()},error:function(e){s.showErrorDialog(e)}}};_.each(["page","section"],function(t){var i=Backbone.$.extend(!0,{},e,{saveDialog:{title:qazana.translate("save_your_template",[qazana.translate(t)])}});s.registerTemplateType(t,i)})};this.init=function(){u()},this.getTemplateTypes=function(e){return e?a[e]:a},this.registerTemplateType=function(e,t){a[e]=t},this.deleteTemplate=function(e){var t=s.getDeleteDialog();t.onConfirm=function(){qazana.ajax.send("delete_template",{data:{source:e.get("source"),template_id:e.get("template_id")},success:function(){l.remove(e,{silent:!0}),s.showTemplates()}})},t.show()},this.importTemplate=function(e){n.showLoadingView(),s.requestTemplateContent(e.get("source"),e.get("template_id"),{success:function(e){s.closeModal(),qazana.getRegion("sections").currentView.addChildModel(e)},error:function(e){s.showErrorDialog(e)}})},this.saveTemplate=function(e,t){var i=a[e];_.extend(t,{source:"local",type:e}),i.prepareSavedData&&(t=i.prepareSavedData(t)),t.data=JSON.stringify(t.data);var n={data:t};i.ajaxParams&&_.extend(n,i.ajaxParams),qazana.ajax.send("save_template",n)},this.requestTemplateContent=function(e,t,i){var n={data:{source:e,edit_mode:!0,template_id:t}};return i&&_.extend(n,i),qazana.ajax.send("get_template_content",n)},this.getDeleteDialog=function(){return t||(t=qazana.dialogsManager.createWidget("confirm",{id:"qazana-template-library-delete-dialog",headerMessage:qazana.translate("delete_template"),message:qazana.translate("delete_template_confirm"),strings:{confirm:qazana.translate("delete")}})),t},this.getErrorDialog=function(){return i||(i=qazana.dialogsManager.createWidget("alert",{id:"qazana-template-library-error-dialog",headerMessage:qazana.translate("an_error_occurred")})),i},this.getModal=function(){return e||(e=qazana.dialogsManager.createWidget("qazana-modal",{id:"qazana-template-library-modal",closeButton:!1})),e},this.getLayout=function(){return n},this.getTemplatesCollection=function(){return l},this.requestRemoteTemplates=function(e,t){!l||t?qazana.ajax.send("get_templates",{success:function(t){l=new o(t),e&&e()}}):e&&e()},this.startModal=function(e){s.getModal().show(),s.setTemplatesSource("remote"),n||d(),n.showLoadingView(),s.requestRemoteTemplates(function(){e&&e()})},this.closeModal=function(){s.getModal().hide()},this.setTemplatesSource=function(e,t){var i=qazana.channels.templates;i.reply("filter:source",e),t&&i.trigger("filter:change")},this.showTemplates=function(){n.showTemplatesView(l)},this.onSearchViewChangeInput=function(e){this.changeFilter(e.ui.input.val(),"search")},this.changeFilter=function(e){qazana.channels.templates.reply("filter:text",e).trigger("filter:change")},this.showErrorDialog=function(e){s.getErrorDialog().setMessage(qazana.translate("templates_request_error")+'<div id="qazana-template-library-error-info">'+e+"</div>").show()}},t.exports=new n},{"qazana-templates/collections/templates":13,"qazana-templates/views/layout":16}],15:[function(e,t,i){var n;n=Backbone.Model.extend({defaults:{template_id:0,name:"",title:"",source:"",type:"",author:"",thumbnail:"",url:"",export_link:"",categories:[],tags:[],keywords:[]}}),t.exports=n},{}],16:[function(e,t,i){var n,r=e("qazana-templates/views/parts/header/logo"),o=e("qazana-templates/views/parts/header/save"),l=e("qazana-templates/views/parts/header/menu"),s=e("qazana-templates/views/parts/header/preview"),a=e("qazana-templates/views/parts/header/search"),d=e("qazana-templates/views/parts/header/back"),u=e("qazana-templates/views/parts/panel/header"),c=e("qazana-templates/views/parts/panel/loading"),h=e("qazana-templates/views/parts/panel/templates"),p=e("qazana-templates/views/parts/panel/save-template"),g=e("qazana-templates/views/parts/panel/import"),m=e("qazana-templates/views/parts/panel/preview");n=Marionette.LayoutView.extend({el:"#qazana-template-library-modal",regions:{modalContent:".dialog-message",modalHeader:".dialog-widget-header"},initialize:function(){this.getRegion("modalHeader").show(new u)},getHeaderView:function(){return this.getRegion("modalHeader").currentView},showLoadingView:function(){this.modalContent.show(new c)},showTemplatesView:function(e){this.modalContent.show(new h({collection:e}));var t=this.getHeaderView();t.tools.show(new o),t.menuArea.show(new l),t.logoArea.show(new r),t.searchArea.show(new a)},showImportView:function(){this.modalContent.show(new g)},showSaveTemplateView:function(e){this.modalContent.show(new p({model:e}));var t=this.getHeaderView();t.tools.reset(),t.menuArea.reset(),t.searchArea.reset(),t.logoArea.show(new r)},showPreviewView:function(e){this.modalContent.show(new m({url:e.get("url")}));var t=this.getHeaderView();t.menuArea.reset(),t.searchArea.reset(),t.tools.show(new s({model:e})),t.logoArea.show(new d)}}),t.exports=n},{"qazana-templates/views/parts/header/back":17,"qazana-templates/views/parts/header/logo":18,"qazana-templates/views/parts/header/menu":19,"qazana-templates/views/parts/header/preview":20,"qazana-templates/views/parts/header/save":21,"qazana-templates/views/parts/header/search":22,"qazana-templates/views/parts/panel/header":23,"qazana-templates/views/parts/panel/import":24,"qazana-templates/views/parts/panel/loading":25,"qazana-templates/views/parts/panel/preview":26,"qazana-templates/views/parts/panel/save-template":27,"qazana-templates/views/parts/panel/templates":29}],17:[function(e,t,i){var n;n=Marionette.ItemView.extend({template:"#tmpl-qazana-template-library-header-back",id:"qazana-template-library-header-preview-back",events:{click:"onClick"},onClick:function(){qazana.templates.showTemplates()}}),t.exports=n},{}],18:[function(e,t,i){var n;n=Marionette.ItemView.extend({template:"#tmpl-qazana-template-library-header-logo",id:"qazana-template-library-header-logo",events:{click:"onClick"},onClick:function(){qazana.templates.setTemplatesSource("remote"),qazana.templates.showTemplates()}}),t.exports=n},{}],19:[function(e,t,i){var n;n=Marionette.ItemView.extend({options:{activeClass:"qazana-active"},template:"#tmpl-qazana-template-library-header-menu",id:"qazana-template-library-header-menu",ui:{menuItems:".qazana-template-library-menu-item"},events:{"click @ui.menuItems":"onMenuItemClick"},$activeItem:null,activateMenuItem:function(e){var t=this.getOption("activeClass");this.$activeItem!==e&&(this.$activeItem&&this.$activeItem.removeClass(t),e.addClass(t),this.$activeItem=e)},onRender:function(){var e=qazana.channels.templates.request("filter:source"),t=this.ui.menuItems.filter('[data-template-source="'+e+'"]');this.activateMenuItem(t)},onMenuItemClick:function(e){var t=e.currentTarget;this.activateMenuItem(Backbone.$(t)),qazana.templates.setTemplatesSource(t.dataset.templateSource,!0)}}),t.exports=n},{}],20:[function(e,t,i){var n;n=Marionette.ItemView.extend({template:"#tmpl-qazana-template-library-header-preview",id:"qazana-template-library-header-preview",ui:{insertButton:"#qazana-template-library-header-preview-insert"},events:{"click @ui.insertButton":"onInsertButtonClick"},onInsertButtonClick:function(){qazana.templates.importTemplate(this.model)}}),t.exports=n},{}],21:[function(e,t,i){var n;n=Marionette.ItemView.extend({template:"#tmpl-qazana-template-library-header-save",id:"qazana-template-library-header-save",className:"qazana-template-library-header-item",events:{click:"onClick"},onClick:function(){qazana.templates.getLayout().showSaveTemplateView()}}),t.exports=n},{}],22:[function(e,t,i){var n;n=Marionette.ItemView.extend({template:"#tmpl-qazana-template-library-header-search",id:"qazana-template-library-header-search-input",ui:{input:"input",clearInput:"#qazana-template-library-header-search-input-clear"},events:{"keyup @ui.input":"onInputChanged","click @ui.clearInput":"clearInput"},onRender:function(){var e=this;e.ui.input.focus(function(){e.$el.addClass("active")}).blur(function(){e.$el.removeClass("active")})},onInputChanged:function(e){27===e.keyCode&&this.clearInput(),qazana.templates.onSearchViewChangeInput(this)},clearInput:function(){this.ui.input.val(""),this.$el.removeClass("active"),qazana.templates.onSearchViewChangeInput(this)}}),t.exports=n},{}],23:[function(e,t,i){var n;n=Marionette.LayoutView.extend({id:"qazana-template-library-header",template:"#tmpl-qazana-template-library-header",regions:{logoArea:"#qazana-template-library-header-logo-area",tools:"#qazana-template-library-header-tools",menuArea:"#qazana-template-library-header-menu-area",searchArea:"#qazana-template-library-header-search-area"},ui:{closeModal:"#qazana-template-library-header-close-modal"},events:{"click @ui.closeModal":"onCloseModalClick"},onCloseModalClick:function(){qazana.templates.closeModal()}}),t.exports=n},{}],24:[function(e,t,i){var n;n=Marionette.ItemView.extend({template:"#tmpl-qazana-template-library-import",id:"qazana-template-library-import",ui:{uploadForm:"#qazana-template-library-import-form"},events:{"submit @ui.uploadForm":"onFormSubmit"},onFormSubmit:function(e){e.preventDefault(),qazana.templates.getLayout().showLoadingView(),qazana.ajax.send("import_template",{data:new FormData(this.ui.uploadForm[0]),processData:!1,contentType:!1,success:function(e){qazana.templates.getTemplatesCollection().add(e.item),qazana.templates.showTemplates()},error:function(e){qazana.templates.showErrorDialog(e)}})}}),t.exports=n},{}],25:[function(e,t,i){var n;n=Marionette.ItemView.extend({id:"qazana-template-library-loading",template:"#tmpl-qazana-template-library-loading"}),t.exports=n},{}],26:[function(e,t,i){var n;n=Marionette.ItemView.extend({template:"#tmpl-qazana-template-library-preview",id:"qazana-template-library-preview",ui:{iframe:"> iframe"},onRender:function(){this.ui.iframe.attr("src",this.getOption("url"))}}),t.exports=n},{}],27:[function(e,t,i){var n;n=Marionette.ItemView.extend({template:"#tmpl-qazana-template-library-save-template",id:"qazana-template-library-save-template",ui:{form:"#qazana-template-library-save-template-form",submitButton:"#qazana-template-library-save-template-submit"},events:{"submit @ui.form":"onFormSubmit"},getSaveType:function(){return this.model?this.model.get("elType"):"page"},templateHelpers:function(){var e=this.getSaveType();return qazana.templates.getTemplateTypes(e).saveDialog},onFormSubmit:function(e){e.preventDefault();var t=this.ui.form.qazanaSerializeObject(),i=this.model?this.model.get("elType"):"page";t.data=this.model?[this.model.toJSON()]:qazana.elements.toJSON(),this.ui.submitButton.addClass("qazana-button-state"),qazana.templates.saveTemplate(i,t)}}),t.exports=n},{}],28:[function(e,t,i){var n;n=Marionette.ItemView.extend({id:"qazana-template-library-templates-empty",template:"#tmpl-qazana-template-library-templates-empty"}),t.exports=n},{}],29:[function(e,t,i){var n,r=e("qazana-templates/views/template/local"),o=e("qazana-templates/views/template/remote"),l=e("qazana-templates/views/template/theme"),s=e("qazana-templates/views/parts/panel/templates-empty");n=Marionette.CompositeView.extend({template:"#tmpl-qazana-template-library-templates",id:"qazana-template-library-templates",childViewContainer:"#qazana-template-library-templates-container",emptyView:s,getChildView:function(e){return"remote"===e.get("source")?o:"theme"===e.get("source")?l:r},initialize:function(){this.listenTo(qazana.channels.templates,"filter:change",this._renderChildren)},filterByName:function(e){var t=qazana.channels.templates.request("filter:text");return!t||(t=t.toLowerCase(),e.get("title").toLowerCase().indexOf(t)>=0||_.any(e.get("keywords"),function(e){return e.toLowerCase().indexOf(t)>=0}))},filterBySource:function(e){var t=qazana.channels.templates.request("filter:source");return!t||t===e.get("source")},filterByType:function(e){return qazana.templates.getTemplateTypes(e.get("type"))&&!1!==qazana.templates.getTemplateTypes(e.get("type")).showInLibrary},filter:function(e){return this.filterByName(e)&&this.filterBySource(e)&&this.filterByType(e)},onRenderCollection:function(){var e=this.children.isEmpty();this.$childViewContainer.attr("data-template-source",e?"empty":qazana.channels.templates.request("filter:source"))}}),t.exports=n},{"qazana-templates/views/parts/panel/templates-empty":28,"qazana-templates/views/template/local":31,"qazana-templates/views/template/remote":32,"qazana-templates/views/template/theme":33}],30:[function(e,t,i){var n;n=Marionette.ItemView.extend({className:function(){return"qazana-template-library-template qazana-template-library-template-"+this.model.get("source")},ui:function(){return{insertButton:".qazana-template-library-template-insert",previewButton:".qazana-template-library-template-preview"}},events:function(){return{"click @ui.insertButton":"onInsertButtonClick","click @ui.previewButton":"onPreviewButtonClick"}},onInsertButtonClick:function(){qazana.templates.importTemplate(this.model)}}),t.exports=n},{}],31:[function(e,t,i){var n,r=e("qazana-templates/views/template/base");n=r.extend({template:"#tmpl-qazana-template-library-template-local",ui:function(){return _.extend(r.prototype.ui.apply(this,arguments),{deleteButton:".qazana-template-library-template-delete"})},events:function(){return _.extend(r.prototype.events.apply(this,arguments),{"click @ui.deleteButton":"onDeleteButtonClick"})},onDeleteButtonClick:function(){qazana.templates.deleteTemplate(this.model)},onPreviewButtonClick:function(){open(this.model.get("url"),"_blank")}}),t.exports=n},{"qazana-templates/views/template/base":30}],32:[function(e,t,i){var n;n=e("qazana-templates/views/template/base").extend({template:"#tmpl-qazana-template-library-template-remote",onPreviewButtonClick:function(){qazana.templates.getLayout().showPreviewView(this.model)}}),t.exports=n},{"qazana-templates/views/template/base":30}],33:[function(e,t,i){var n;n=e("qazana-templates/views/template/base").extend({template:"#tmpl-qazana-template-library-template-theme",onPreviewButtonClick:function(){qazana.templates.getLayout().showPreviewView(this.model)}}),t.exports=n},{"qazana-templates/views/template/base":30}],34:[function(e,t,i){var n;Marionette.TemplateCache.prototype.compileTemplate=function(e,t){return t={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g},_.template(e,t)},n=Marionette.Application.extend({helpers:e("qazana-utils/helpers"),heartbeat:e("qazana-utils/heartbeat"),imagesManager:e("qazana-utils/images-manager"),schemes:e("qazana-utils/schemes"),presetsFactory:e("qazana-utils/presets-factory"),modals:e("qazana-utils/modals"),templates:e("qazana-templates/manager"),ajax:e("qazana-utils/ajax"),conditions:e("qazana-utils/conditions"),revisions:e("qazana-revisions/manager"),hotKeys:e("qazana-utils/hot-keys"),channels:{editor:Backbone.Radio.channel("BUILDER:editor"),data:Backbone.Radio.channel("BUILDER:data"),panelElements:Backbone.Radio.channel("BUILDER:panelElements"),dataEditMode:Backbone.Radio.channel("BUILDER:editmode"),deviceMode:Backbone.Radio.channel("BUILDER:deviceMode"),templates:Backbone.Radio.channel("BUILDER:templates")},modules:{element:e("qazana-models/element"),WidgetView:e("qazana-views/widget"),templateLibrary:{ElementsCollectionView:e("qazana-panel/pages/elements/views/elements")}},_controlsItemView:null,_defaultDeviceMode:"desktop",getElementData:function(e){var t=e.get("elType");if("widget"===t){var i=e.get("widgetType");return!!this.config.widgets[i]&&this.config.widgets[i]}return!!this.config.elements[t]&&this.config.elements[t]},getElementControls:function(e){var t=this.getElementData(e);if(!t)return!1;if("widget"===e.get("elType"))return t.controls;var i=e.get("isInner");return _.filter(t.controls,function(e){return!(i&&e.hide_in_inner||!i&&e.hide_in_top)})},getControlItemView:function(t){return null===this._controlsItemView&&(this._controlsItemView={color:e("qazana-views/controls/color"),dimensions:e("qazana-views/controls/dimensions"),image_dimensions:e("qazana-views/controls/image-dimensions"),media:e("qazana-views/controls/media"),slider:e("qazana-views/controls/slider"),wysiwyg:e("qazana-views/controls/wysiwyg"),choose:e("qazana-views/controls/choose"),url:e("qazana-views/controls/url"),font:e("qazana-views/controls/font"),section:e("qazana-views/controls/section"),tab:e("qazana-views/controls/tab"),repeater:e("qazana-views/controls/repeater"),wp_widget:e("qazana-views/controls/wp_widget"),icon:e("qazana-views/controls/icon"),gallery:e("qazana-views/controls/gallery"),select2:e("qazana-views/controls/select2"),date_time:e("qazana-views/controls/date-time"),code:e("qazana-views/controls/code"),box_shadow:e("qazana-views/controls/box-shadow"),structure:e("qazana-views/controls/structure"),animation:e("qazana-views/controls/animation"),hover_animation:e("qazana-views/controls/animation"),order:e("qazana-views/controls/order")},this.channels.editor.trigger("controls:initialize")),this._controlsItemView[t]||e("qazana-views/controls/base")},getPanelView:function(){return this.getRegion("panel").currentView},initComponents:function(){var t=e("../utils/hooks");this.hooks=new t,this.templates.init(),this.initDialogsManager(),this.heartbeat.init(),this.modals.init(),this.ajax.init(),this.revisions.init(),this.hotKeys.init()},initDialogsManager:function(){this.dialogsManager=new DialogsManager.Instance},initElements:function(){var e=qazana.modules.element;this.elements=new e.Collection(this.config.data)},initPreview:function(){this.$previewWrapper=Backbone.$("#qazana-preview"),this.$previewResponsiveWrapper=Backbone.$("#qazana-preview-responsive-wrapper");if(!Backbone.$("#qazana-preview-iframe").length){var e=document.createElement("iframe");e.id="qazana-preview-iframe",e.src=this.config.preview_link+"&"+(new Date).getTime(),this.$previewResponsiveWrapper.append(e)}this.$preview=Backbone.$("#qazana-preview-iframe"),this.$preview.on("load",_.bind(this.onPreviewLoaded,this)),this.initElements()},initFrontend:function(){qazanaFrontend.setScopeWindow(this.$preview[0].contentWindow),qazanaFrontend.init()},initClearPageDialog:function(){var e,t=this;t.getClearPageDialog=function(){return e||(e=this.dialogsManager.createWidget("confirm",{id:"qazana-clear-page-dialog",headerMessage:qazana.translate("clear_page"),message:qazana.translate("dialog_confirm_clear_page"),position:{my:"center center",at:"center center"},strings:{confirm:qazana.translate("delete"),cancel:qazana.translate("cancel")},onConfirm:function(){t.getRegion("sections").currentView.collection.reset()}}))}},onStart:function(){this.$window=Backbone.$(window),NProgress.start(),NProgress.inc(.2),this.config=QazanaConfig,Backbone.Radio.DEBUG=!1,Backbone.Radio.tuneIn("BUILDER"),this.initComponents(),this.listenTo(this.channels.dataEditMode,"switch",this.onEditModeSwitched),this.setWorkSaver(),this.initClearPageDialog(),this.$window.trigger("qazana:init"),this.initPreview()},onPreviewLoaded:function(){NProgress.done(),this.initFrontend(),this.hotKeys.bindListener(Backbone.$(qazanaFrontend.getScopeWindow())),this.$previewContents=this.$preview.contents();var t=e("qazana-views/preview"),i=e("qazana-layouts/panel/panel"),n=this.$previewContents.find("#qazana");if(n.length){var r=new Marionette.Region({el:n[0]});this.schemes.init(),this.schemes.printSchemesStyle(),this.$previewContents.on("click",function(e){var t=Backbone.$(e.target),i=qazana.channels.dataEditMode.request("activeMode"),n=!!t.closest("#qazana").length,r=this.contains(t[0]);if((!n||"edit"!==i)&&r&&(t.closest("a").length&&e.preventDefault(),!n)){var o=qazana.getPanelView();"elements"!==o.getCurrentPageName()&&o.setPage("elements")}}),this.addRegions({sections:r,panel:"#qazana-panel"}),this.getRegion("sections").show(new t({collection:this.elements})),this.getRegion("panel").show(new i),this.$previewContents.children().addClass("qazana-html").children("body").addClass("qazana-editor-active").addClass("qazana-page"),this.setResizablePanel(),this.changeDeviceMode(this._defaultDeviceMode),Backbone.$("#qazana-loading, #qazana-preview-loading").fadeOut(600),_.defer(function(){qazanaFrontend.getScopeWindow().jQuery.holdReady(!1)}),this.enqueueTypographyFonts(),this.trigger("preview:loaded")}else this.onPreviewElNotFound()},onEditModeSwitched:function(e){"edit"===e?this.exitPreviewMode():this.enterPreviewMode("preview"===e)},onPreviewElNotFound:function(){this.dialogsManager.createWidget("confirm",{id:"qazana-fatal-error-dialog",headerMessage:qazana.translate("preview_el_not_found_header"),message:qazana.translate("preview_el_not_found_message"),position:{my:"center center",at:"center center"},strings:{confirm:qazana.translate("learn_more"),cancel:qazana.translate("go_back")},onConfirm:function(){open(qazana.config.help_the_content_url,"_blank")},onCancel:function(){parent.history.go(-1)},hideOnButtonClick:!1}).show()},setFlagEditorChange:function(e){qazana.channels.editor.reply("change",e).trigger("change",e)},isEditorChanged:function(){return!0===qazana.channels.editor.request("change")},setWorkSaver:function(){this.$window.on("beforeunload",function(){if(qazana.isEditorChanged())return qazana.translate("before_unload_alert")})},setResizablePanel:function(){var e=this,t=qazana.config.is_rtl?"right":"left";e.panel.$el.resizable({handles:qazana.config.is_rtl?"w":"e",minWidth:200,maxWidth:680,start:function(){e.$previewWrapper.addClass("ui-resizable-resizing").css("pointer-events","none")},stop:function(){e.$previewWrapper.removeClass("ui-resizable-resizing").css("pointer-events",""),qazana.channels.data.trigger("scrollbar:update")},resize:function(i,n){e.$previewWrapper.css(t,n.size.width)}})},enterPreviewMode:function(e){var t=this.$previewContents.find("body");e&&(t=t.add("body")),t.removeClass("qazana-editor-active").addClass("qazana-editor-preview"),e&&(this.$previewWrapper.css(qazana.config.is_rtl?"right":"left",""),this.panel.$el.css("width",""))},exitPreviewMode:function(){this.$previewContents.find("body").add("body").removeClass("qazana-editor-preview").addClass("qazana-editor-active")},changeEditMode:function(e){var t=qazana.channels.dataEditMode,i=t.request("activeMode");t.reply("activeMode",e),e!==i&&t.trigger("switch",e)},saveEditor:function(e){e=_.extend({status:"draft",save_state:"save",onSuccess:null},e),0===qazana.elements.length&&(e.save_state="delete");var t=this,i=qazana.elements.toJSON();return this.ajax.send("save_qazana",{data:{post_id:this.config.post_id,status:e.status,save_state:e.save_state,data:JSON.stringify(i)},success:function(n){t.setFlagEditorChange(!1),t.config.data=i,t.channels.editor.trigger("saved",n),_.isFunction(e.onSuccess)&&e.onSuccess.call(this,n)}})},reloadPreview:function(){Backbone.$("#qazana-preview-loading").show(),this.$preview[0].contentWindow.location.reload(!0)},clearPage:function(){this.getClearPageDialog().show()},changeDeviceMode:function(e){var t=this.channels.deviceMode.request("currentMode");t!==e&&(Backbone.$("body").removeClass("qazana-device-"+t).addClass("qazana-device-"+e),this.channels.deviceMode.reply("previousMode",t).reply("currentMode",e).trigger("change"))},enqueueTypographyFonts:function(){var e=this,t=this.schemes.getScheme("typography");_.each(t.items,function(t){e.helpers.enqueueFont(t.value.font_family)})},translate:function(e,t,i){i||(i=this.config.i18n);var n=i[e];return void 0===n&&(n=e),t&&(n=n.replace(/{(\d+)}/g,function(e,i){return void 0!==t[i]?t[i]:e})),n}}),t.exports=(window.qazana=new n).start()},{"../utils/hooks":110,"qazana-layouts/panel/panel":59,"qazana-models/element":62,"qazana-panel/pages/elements/views/elements":46,"qazana-revisions/manager":9,"qazana-templates/manager":14,"qazana-utils/ajax":65,"qazana-utils/conditions":66,"qazana-utils/heartbeat":67,"qazana-utils/helpers":68,"qazana-utils/hot-keys":69,"qazana-utils/images-manager":70,"qazana-utils/modals":73,"qazana-utils/presets-factory":74,"qazana-utils/schemes":75,"qazana-views/controls/animation":80,"qazana-views/controls/base":83,"qazana-views/controls/box-shadow":84,"qazana-views/controls/choose":85,"qazana-views/controls/code":86,"qazana-views/controls/color":87,"qazana-views/controls/date-time":88,"qazana-views/controls/dimensions":89,"qazana-views/controls/font":90,"qazana-views/controls/gallery":91,"qazana-views/controls/icon":92,"qazana-views/controls/image-dimensions":93,"qazana-views/controls/media":94,"qazana-views/controls/order":95,"qazana-views/controls/repeater":97,"qazana-views/controls/section":98,"qazana-views/controls/select2":99,"qazana-views/controls/slider":100,"qazana-views/controls/structure":101,"qazana-views/controls/tab":102,"qazana-views/controls/url":103,"qazana-views/controls/wp_widget":104,"qazana-views/controls/wysiwyg":105,"qazana-views/preview":107,"qazana-views/widget":109}],35:[function(e,t,i){var n;n=Marionette.ItemView.extend({template:"#tmpl-qazana-mode-switcher-content",id:"qazana-mode-switcher-inner",ui:{previewButton:"#qazana-mode-switcher-preview-input",previewLabel:"#qazana-mode-switcher-preview",previewLabelA11y:"#qazana-mode-switcher-preview .qazana-screen-only"},events:{"change @ui.previewButton":"onPreviewButtonChange"},initialize:function(){this.listenTo(qazana.channels.dataEditMode,"switch",this.onEditModeChanged)},getCurrentMode:function(){return this.ui.previewButton.is(":checked")?"preview":"edit"},setMode:function(e){this.ui.previewButton.prop("checked","preview"===e).trigger("change")},toggleMode:function(){this.setMode(this.ui.previewButton.prop("checked")?"edit":"preview")},onRender:function(){this.onPreviewButtonChange()},onPreviewButtonChange:function(){qazana.changeEditMode(this.getCurrentMode())},onEditModeChanged:function(e){var t=qazana.translate("preview"===e?"back_to_editor":"preview");this.ui.previewLabel.attr("title",t),this.ui.previewLabelA11y.text(t)}}),t.exports=n},{}],36:[function(e,t,i){var n;n=Marionette.ItemView.extend({template:"#tmpl-qazana-panel-footer-content",tagName:"nav",id:"qazana-panel-footer-tools",possibleRotateModes:["portrait","landscape"],ui:{menuButtons:".qazana-panel-footer-tool",deviceModeIcon:"#qazana-panel-footer-responsive > i",deviceModeButtons:"#qazana-panel-footer-responsive .qazana-panel-footer-sub-menu-item",buttonSave:"#qazana-panel-footer-save",buttonSaveButton:"#qazana-panel-footer-save .qazana-button",buttonPublish:"#qazana-panel-footer-publish",watchTutorial:"#qazana-panel-footer-watch-tutorial",showTemplates:"#qazana-panel-footer-templates-modal",saveTemplate:"#qazana-panel-footer-save-template"},events:{"click @ui.deviceModeButtons":"onClickResponsiveButtons","click @ui.buttonSave":"onClickButtonSave","click @ui.buttonPublish":"onClickButtonPublish","click @ui.watchTutorial":"onClickWatchTutorial","click @ui.showTemplates":"onClickShowTemplates","click @ui.saveTemplate":"onClickSaveTemplate"},initialize:function(){this._initDialog(),this.listenTo(qazana.channels.editor,"change",this.onEditorChanged).listenTo(qazana.channels.deviceMode,"change",this.onDeviceModeChange)},_initDialog:function(){var e;this.getDialog=function(){if(!e){var t=Backbone.$,i=t("<div>",{class:"qazana-dialog-message"}),n=t("<i>",{class:"fa fa-check-circle"}),r=t("<div>",{class:"qazana-dialog-message-text"}).text(qazana.translate("saved"));i.append(n,r),(e=qazana.dialogsManager.createWidget("popup",{hide:{delay:1500}})).setMessage(i)}return e}},_publishQazana:function(){var e=this,t={status:"publish",onSuccess:function(){e.getDialog().show(),e.ui.buttonSaveButton.removeClass("qazana-button-state"),NProgress.done()}};e.ui.buttonSaveButton.addClass("qazana-button-state"),NProgress.start(),qazana.saveEditor(t)},_saveQazanaDraft:function(){qazana.saveEditor()},getDeviceModeButton:function(e){return this.ui.deviceModeButtons.filter('[data-device-mode="'+e+'"]')},onPanelClick:function(e){var t=Backbone.$(e.target);if(!t.closest(".qazana-panel-footer-sub-menu-wrapper").length){var i=t.closest(".qazana-panel-footer-tool"),n=i.length&&!i.hasClass("qazana-open");this.ui.menuButtons.removeClass("qazana-open"),n&&i.addClass("qazana-open")}},onEditorChanged:function(){this.ui.buttonSave.toggleClass("qazana-save-active",qazana.isEditorChanged())},onDeviceModeChange:function(){var e=qazana.channels.deviceMode.request("previousMode"),t=qazana.channels.deviceMode.request("currentMode");this.getDeviceModeButton(e).removeClass("active"),this.getDeviceModeButton(t).addClass("active"),this.ui.deviceModeIcon.removeClass("eicon-device-"+e).addClass("eicon-device-"+t)},onClickButtonSave:function(){this._publishQazana()},onClickButtonPublish:function(e){e.stopPropagation(),this._publishQazana()},onClickResponsiveButtons:function(e){var t=this.$(e.currentTarget).data("device-mode");qazana.changeDeviceMode(t)},onClickWatchTutorial:function(){qazana.introduction.startIntroduction()},onClickShowTemplates:function(){qazana.templates.startModal(function(){qazana.templates.showTemplates()})},onClickSaveTemplate:function(){qazana.templates.startModal(function(){qazana.templates.getLayout().showSaveTemplateView()})},onRender:function(){var e=this;_.defer(function(){qazana.getPanelView().$el.on("click",_.bind(e.onPanelClick,e))})}}),t.exports=n},{}],37:[function(e,t,i){var n;n=Marionette.ItemView.extend({template:"#tmpl-qazana-panel-header",id:"qazana-panel-header",ui:{menuButton:"#qazana-panel-header-menu-button",menuDropButton:"#qazana-panel-header-nav-button",title:"#qazana-panel-header-title",addButton:"#qazana-panel-header-add-button",buttonSave:"#qazana-panel-header-save",buttonSaveButton:"#qazana-panel-header-save .qazana-button"},events:{"click @ui.addButton":"onClickAdd","click @ui.menuButton":"onClickMenu","click @ui.menuDropButton":"onClickMenuDrop","click @ui.buttonSave":"onClickButtonSave","click @ui.buttonPublish":"onClickButtonPublish"},initialize:function(){this._initDialog(),this.onClickMenuDrop(),this.listenTo(qazana.channels.editor,"change",this.onEditorChanged).listenTo(qazana.channels.deviceMode,"change",this.onDeviceModeChange)},_initDialog:function(){var e;this.getDialog=function(){if(!e){var t=Backbone.$,i=t("<div>",{class:"qazana-dialog-message"}),n=t("<i>",{class:"fa fa-check-circle"}),r=t("<div>",{class:"qazana-dialog-message-text"}).text(qazana.translate("saved"));i.append(n,r),(e=qazana.dialogsManager.createWidget("popup",{hide:{delay:1500}})).setMessage(i)}return e}},_publishQazana:function(){var e=this,t={status:"publish",onSuccess:function(){e.getDialog().show(),e.ui.buttonSaveButton.removeClass("qazana-button-state"),NProgress.done()}};e.ui.buttonSaveButton.addClass("qazana-button-state"),NProgress.start(),qazana.saveEditor(t)},_saveQazanaDraft:function(){qazana.saveEditor()},setTitle:function(e){this.ui.title.html(e)},onClickAdd:function(){qazana.getPanelView().setPage("elements")},onClickMenu:function(){var e=qazana.getPanelView(),t="menu"===e.getCurrentPageName()?"elements":"menu";e.setPage(t)},onClickMenuDrop:function(){var e=Backbone.$;e("ul.qazana-panel-header-nav > li").hoverIntent(function(){e(this).addClass("qazana-menu-hover")},function(){e(this).removeClass("qazana-menu-hover")})},onEditorChanged:function(){this.ui.buttonSave.toggleClass("qazana-save-active",qazana.isEditorChanged())},onClickButtonSave:function(){this._publishQazana()},onClickButtonPublish:function(e){e.stopPropagation(),this._publishQazana()}}),t.exports=n},{}],38:[function(e,t,i){var n;n=Marionette.CompositeView.extend({template:Marionette.TemplateCache.get("#tmpl-editor-content"),id:"qazana-panel-page-editor",templateHelpers:function(){return{elementData:qazana.getElementData(this.model)}},behaviors:{HandleInnerTabs:{behaviorClass:e("qazana-behaviors/inner-tabs")}},childViewContainer:"#qazana-controls",modelEvents:{destroy:"onModelDestroy"},ui:{tabs:".qazana-panel-navigation-tab",reloadButton:"#qazana-update-preview-button"},events:{"click @ui.tabs a":"onClickTabControl","click @ui.reloadButton":"onReloadButtonClick"},initialize:function(){this.listenTo(qazana.channels.deviceMode,"change",this.onDeviceModeChange)},getChildView:function(e){var t=e.get("type");return qazana.getControlItemView(t)},childViewOptions:function(){return{elementSettingsModel:this.model.get("settings"),elementEditSettings:this.model.get("editSettings")}},onDestroy:function(){this.editedElementView&&this.editedElementView.$el.removeClass("qazana-element-editable"),this.model.trigger("editor:close"),this.triggerMethod("editor:destroy")},onBeforeRender:function(){var e=qazana.getElementControls(this.model);if(!e)throw new Error("Editor controls not found");this.collection=new Backbone.Collection(_.values(e))},onRender:function(){this.editedElementView&&this.editedElementView.$el.addClass("qazana-element-editable"),this.ui.tabs.eq(0).find("a").trigger("click"),this.$(".tooltip-target").tipsy({gravity:function(){var e=Backbone.$(this).data("tooltip-pos");return void 0!==e?e:"n"},title:function(){return this.getAttribute("data-tooltip")}})},onModelDestroy:function(){this.destroy()},onClickTabControl:function(e){e.preventDefault();var t=this.$(e.target);this.ui.tabs.removeClass("active"),t.closest(".qazana-panel-navigation-tab").addClass("active"),this.model.get("settings").trigger("control:switch:tab",t.data("tab")),this.openFirstSectionInCurrentTab(t.data("tab"))},onDeviceModeChange:function(){var e=this;e.$el.removeClass("qazana-responsive-switchers-open"),setTimeout(function(){qazana.$previewContents.find("html, body").animate({scrollTop:e.getOption("editedElementView").$el.offset().top-qazana.$preview[0].contentWindow.innerHeight/2})},500)},openFirstSectionInCurrentTab:function(e){var t=this.children.filter(function(e){return!_.isEmpty(e.model.get("section"))}),i=this.children.filter(function(t){return"section"===t.model.get("type")&&e===t.model.get("tab")});_.isEmpty(i)||((i=i[0]).ui.heading.addClass("qazana-open"),_.each(t,function(e){e.model.get("section")===i.model.get("name")?e.$el.addClass("qazana-open"):e.$el.removeClass("qazana-open")}))},onChildviewControlSectionClicked:function(e){var t=e.model.get("name"),i=e.ui.heading.hasClass("qazana-open"),n=this.children.filter(function(e){return!_.isEmpty(e.model.get("section"))});this.$(".qazana-control.qazana-control-type-section .qazana-panel-heading").removeClass("qazana-open"),i?t="":e.ui.heading.addClass("qazana-open"),_.each(n,function(e){e.model.get("section")===t?e.$el.addClass("qazana-open"):e.$el.removeClass("qazana-open")}),qazana.channels.data.trigger("scrollbar:update")},onReloadButtonClick:function(){qazana.reloadPreview()}}),t.exports=n},{"qazana-behaviors/inner-tabs":4}],39:[function(e,t,i){var n,r=e("../models/element");n=Backbone.Collection.extend({model:r}),t.exports=n},{"../models/element":42}],40:[function(e,t,i){var n,r=e("../models/element");n=Backbone.Collection.extend({model:r}),t.exports=n},{"../models/element":42}],41:[function(e,t,i){var n,r=e("./collections/categories"),o=e("./collections/elements"),l=e("./views/categories"),s=qazana.modules.templateLibrary.ElementsCollectionView,a=e("./views/search"),d=e("./views/global");n=Marionette.LayoutView.extend({template:"#tmpl-qazana-panel-elements",regions:{elements:"#qazana-panel-elements-wrapper",search:"#qazana-panel-elements-search-area"},ui:{tabs:".qazana-panel-navigation-tab"},events:{"click @ui.tabs":"onTabClick"},regionViews:{},elementsCollection:null,categoriesCollection:null,initialize:function(){this.listenTo(qazana.channels.panelElements,"element:selected",this.destroy),this.initElementsCollection(),this.initCategoriesCollection(),this.initRegionViews()},initRegionViews:function(){var e={elements:{region:this.elements,view:s,options:{collection:this.elementsCollection}},categories:{region:this.elements,view:l,options:{collection:this.categoriesCollection}},search:{region:this.search,view:a},global:{region:this.elements,view:d}};this.regionViews=qazana.hooks.applyFilters("panel/elements/regionViews",e)},initElementsCollection:function(){var e=new o,t=qazana.config.elements.section;e.add({title:qazana.translate("inner_section"),elType:"section",categories:["basic"],icon:t.icon}),_.each(qazana.config.widgets,function(t){e.add({title:t.title,elType:t.elType,categories:t.categories,keywords:t.keywords,icon:t.icon,widgetType:t.widget_type,custom:t.custom})}),this.elementsCollection=e},initCategoriesCollection:function(){var e={};this.elementsCollection.each(function(t){_.each(t.get("categories"),function(i){e[i]||(e[i]=[]),e[i].push(t)})});var t=new r;_.each(qazana.config.elements_categories,function(i,n){e[n]&&t.add({name:n,title:i.title,icon:i.icon,items:e[n]})}),this.categoriesCollection=t},activateTab:function(e){this.ui.tabs.removeClass("active").filter('[data-view="'+e+'"]').addClass("active"),this.showView(e)},showView:function(e){var t=this.regionViews[e],i=t.options||{};t.region.show(new t.view(i))},clearSearchInput:function(){this.getChildView("search").clearInput()},changeFilter:function(e){qazana.channels.panelElements.reply("filter:value",e).trigger("filter:change")},clearFilters:function(){this.changeFilter(null),this.clearSearchInput()},onChildviewChildrenRender:function(){this.updateElementsScrollbar()},onChildviewSearchChangeInput:function(e){this.changeFilter(e.ui.input.val(),"search")},onDestroy:function(){qazana.channels.panelElements.reply("filter:value",null)},onShow:function(){this.showView("categories"),this.showView("search")},onTabClick:function(e){this.activateTab(e.currentTarget.dataset.view)},updateElementsScrollbar:function(){qazana.channels.data.trigger("scrollbar:update")}}),t.exports=n},{"./collections/categories":39,"./collections/elements":40,"./views/categories":43,"./views/global":47,"./views/search":48}],42:[function(e,t,i){var n;n=Backbone.Model.extend({defaults:{title:"",categories:[],keywords:[],icon:"",elType:"widget",widgetType:""}}),t.exports=n},{}],43:[function(e,t,i){var n,r=e("./category");n=Marionette.CompositeView.extend({template:"#tmpl-qazana-panel-categories",childView:r,childViewContainer:"#qazana-panel-categories",id:"qazana-panel-elements-categories",initialize:function(){this.listenTo(qazana.channels.panelElements,"filter:change",this.onPanelElementsFilterChange)},onPanelElementsFilterChange:function(){qazana.getPanelView().getCurrentPageView().showView("elements")}}),t.exports=n},{"./category":44}],44:[function(e,t,i){var n,r=e("../collections/elements");n=Marionette.CompositeView.extend({template:"#tmpl-qazana-panel-elements-category",className:"qazana-panel-category",childView:e("qazana-panel/pages/elements/views/element"),childViewContainer:".panel-elements-category-items",initialize:function(){this.collection=new r(this.model.get("items"))}}),t.exports=n},{"../collections/elements":40,"qazana-panel/pages/elements/views/element":45}],45:[function(e,t,i){var n;n=Marionette.ItemView.extend({template:"#tmpl-qazana-element-library-element",className:"qazana-element-wrapper",onRender:function(){var e=this;this.$el.html5Draggable({onDragStart:function(){qazana.channels.panelElements.reply("element:selected",e).trigger("element:drag:start")},onDragEnd:function(){qazana.channels.panelElements.trigger("element:drag:end")},groups:["qazana-element"]})}}),t.exports=n},{}],46:[function(e,t,i){var n;n=Marionette.CollectionView.extend({childView:e("qazana-panel/pages/elements/views/element"),id:"qazana-panel-elements",initialize:function(){this.listenTo(qazana.channels.panelElements,"filter:change",this.onFilterChanged)},filter:function(e){var t=qazana.channels.panelElements.request("filter:value");return!t||(-1!==e.get("title").toLowerCase().indexOf(t.toLowerCase())||_.any(e.get("keywords"),function(e){return-1!==e.toLowerCase().indexOf(t.toLowerCase())}))},onFilterChanged:function(){qazana.channels.panelElements.request("filter:value")||this.onFilterEmpty(),this._renderChildren(),this.triggerMethod("children:render")},onFilterEmpty:function(){qazana.getPanelView().getCurrentPageView().showView("categories")}}),t.exports=n},{"qazana-panel/pages/elements/views/element":45}],47:[function(e,t,i){t.exports=Marionette.ItemView.extend({template:"#tmpl-qazana-panel-global",id:"qazana-panel-global",initialize:function(){qazana.getPanelView().getCurrentPageView().search.reset()},onDestroy:function(){qazana.getPanelView().getCurrentPageView().showView("search")}})},{}],48:[function(e,t,i){var n;n=Marionette.ItemView.extend({template:"#tmpl-qazana-panel-element-search",id:"qazana-panel-elements-search-wrapper",ui:{input:"input"},events:{"keyup @ui.input":"onInputChanged"},onInputChanged:function(e){27===e.keyCode&&this.clearInput(),this.triggerMethod("search:change:input")},clearInput:function(){this.ui.input.val("")}}),t.exports=n},{}],49:[function(e,t,i){var n,r=e("qazana-panel/pages/menu/views/item");n=Marionette.CollectionView.extend({id:"qazana-panel-page-menu",childView:r,initialize:function(){this.collection=new Backbone.Collection([{icon:"paint-brush",title:qazana.translate("global_colors"),type:"page",pageName:"colorScheme"},{icon:"font",title:qazana.translate("global_fonts"),type:"page",pageName:"typographyScheme"},{icon:"eyedropper",title:qazana.translate("color_picker"),type:"page",pageName:"colorPickerScheme"},{icon:"history",title:qazana.translate("revision_history"),type:"page",pageName:"revisionsPage"},{icon:"cog",title:qazana.translate("qazana_settings"),type:"link",link:qazana.config.settings_page_link,newTab:!0},{icon:"eraser",title:qazana.translate("clear_page"),callback:function(){qazana.clearPage()}},{icon:"info-circle",title:qazana.translate("about_qazana"),type:"link",link:qazana.config.qazana_site,newTab:!0}])},onChildviewClick:function(e){switch(e.model.get("type")){case"page":var t=e.model.get("pageName"),i=e.model.get("title");qazana.getPanelView().setPage(t,i);break;case"link":var n=e.model.get("link");e.model.get("newTab")?open(n,"_blank"):location.href=e.model.get("link");break;default:var r=e.model.get("callback");_.isFunction(r)&&r.call(e)}}}),t.exports=n},{"qazana-panel/pages/menu/views/item":50}],50:[function(e,t,i){var n;n=Marionette.ItemView.extend({template:"#tmpl-qazana-panel-menu-item",className:"qazana-panel-menu-item",triggers:{click:"click"}}),t.exports=n},{}],51:[function(e,t,i){var n,r={color:e("qazana-panel/pages/schemes/items/color"),typography:e("qazana-panel/pages/schemes/items/typography")};n=Marionette.CompositeView.extend({id:function(){return"qazana-panel-scheme-"+this.getType()},className:function(){return"qazana-panel-scheme qazana-panel-scheme-"+this.getUIType()},childViewContainer:".qazana-panel-scheme-items",getTemplate:function(){return Marionette.TemplateCache.get("#tmpl-qazana-panel-schemes-"+this.getType())},getChildView:function(){return r[this.getUIType()]},getUIType:function(){return this.getType()},ui:function(){return{saveButton:".qazana-panel-scheme-save .qazana-button",discardButton:".qazana-panel-scheme-discard .qazana-button",resetButton:".qazana-panel-scheme-reset .qazana-button"}},events:function(){return{"click @ui.saveButton":"saveScheme","click @ui.discardButton":"discardScheme","click @ui.resetButton":"setDefaultScheme"}},initialize:function(){this.model=new Backbone.Model,this.resetScheme()},getType:function(){},getScheme:function(){return qazana.schemes.getScheme(this.getType())},changeChildrenUIValues:function(e){var t=this;_.each(e,function(e,i){var n=t.collection.findWhere({key:i});t.children.findByModelCid(n.cid).changeUIValue(e)})},discardScheme:function(){qazana.schemes.resetSchemes(this.getType()),this.onSchemeChange(),this.ui.saveButton.prop("disabled",!0),this._renderChildren()},setSchemeValue:function(e,t){qazana.schemes.setSchemeValue(this.getType(),e,t),this.onSchemeChange()},saveScheme:function(){qazana.schemes.saveScheme(this.getType()),this.ui.saveButton.prop("disabled",!0),this.resetScheme(),this._renderChildren()},setDefaultScheme:function(){var e=qazana.config.default_schemes[this.getType()].items;this.changeChildrenUIValues(e)},resetItems:function(){this.model.set("items",this.getScheme().items)},resetCollection:function(){var e=this.model.get("items");this.collection=new Backbone.Collection,_.each(e,_.bind(function(e,t){e.type=this.getType(),e.key=t,this.collection.add(e)},this))},resetScheme:function(){this.resetItems(),this.resetCollection()},onSchemeChange:function(){qazana.schemes.printSchemesStyle()},onChildviewValueChange:function(e,t){this.ui.saveButton.removeProp("disabled"),this.setSchemeValue(e.model.get("key"),t)}}),t.exports=n},{"qazana-panel/pages/schemes/items/color":56,"qazana-panel/pages/schemes/items/typography":57}],52:[function(e,t,i){var n;n=e("qazana-panel/pages/schemes/colors").extend({getType:function(){return"color-picker"},getUIType:function(){return"color"},onSchemeChange:function(){},getViewComparator:function(){return this.orderView},orderView:function(e){return qazana.helpers.getColorPickerPaletteIndex(e.get("key"))}}),t.exports=n},{"qazana-panel/pages/schemes/colors":53}],53:[function(e,t,i){var n,r=e("qazana-panel/pages/schemes/base");n=r.extend({ui:function(){var e=r.prototype.ui.apply(this,arguments);return e.systemSchemes=".qazana-panel-scheme-color-system-scheme",e},events:function(){var e=r.prototype.events.apply(this,arguments);return e["click @ui.systemSchemes"]="onSystemSchemeClick",e},getType:function(){return"color"},onSystemSchemeClick:function(e){var t=Backbone.$(e.currentTarget).data("schemeName"),i=qazana.config.system_schemes[this.getType()][t].items;this.changeChildrenUIValues(i)}}),t.exports=n},{"qazana-panel/pages/schemes/base":51}],54:[function(e,t,i){var n;n=Marionette.ItemView.extend({template:"#tmpl-qazana-panel-schemes-disabled",id:"qazana-panel-schemes-disabled",className:"qazana-panel-nerd-box",disabledTitle:"",templateHelpers:function(){return{disabledTitle:this.disabledTitle}}}),t.exports=n},{}],55:[function(e,t,i){var n;n=Marionette.ItemView.extend({getTemplate:function(){return Marionette.TemplateCache.get("#tmpl-qazana-panel-scheme-"+this.getUIType()+"-item")},className:function(){return"qazana-panel-scheme-item"}}),t.exports=n},{}],56:[function(e,t,i){var n;n=e("qazana-panel/pages/schemes/items/base").extend({getUIType:function(){return"color"},ui:{input:".qazana-panel-scheme-color-value"},changeUIValue:function(e){this.ui.input.wpColorPicker("color",e)},onBeforeDestroy:function(){this.ui.input.wpColorPicker("instance")&&this.ui.input.wpColorPicker("close")},onRender:function(){qazana.helpers.wpColorPicker(this.ui.input,{change:_.bind(function(e,t){this.triggerMethod("value:change",t.color.toString())},this)})}}),t.exports=n},{"qazana-panel/pages/schemes/items/base":55}],57:[function(e,t,i){var n,r=e("qazana-panel/pages/schemes/items/base");n=r.extend({getUIType:function(){return"typography"},className:function(){return r.prototype.className.apply(this,arguments)+" qazana-panel-box"},ui:{heading:".qazana-panel-heading",allFields:".qazana-panel-scheme-typography-item-field",inputFields:"input.qazana-panel-scheme-typography-item-field",selectFields:"select.qazana-panel-scheme-typography-item-field",selectFamilyFields:'select.qazana-panel-scheme-typography-item-field[name="font_family"]'},events:{"input @ui.inputFields":"onFieldChange","change @ui.selectFields":"onFieldChange","click @ui.heading":"toggleVisibility"},onRender:function(){var e=this;this.ui.inputFields.add(this.ui.selectFields).each(function(){var t=Backbone.$(this),i=t.attr("name"),n=e.model.get("value")[i];t.val(n)}),this.ui.selectFamilyFields.select2({dir:qazana.config.is_rtl?"rtl":"ltr"})},toggleVisibility:function(){this.ui.heading.toggleClass("qazana-open")},changeUIValue:function(e){this.ui.allFields.each(function(){var t=Backbone.$(this),i=t.attr("name"),n=e[i];t.val(n).trigger("change")})},onFieldChange:function(e){var t=this.$(e.currentTarget),i=qazana.schemes.getSchemeValue("typography",this.model.get("key")).value,n=t.attr("name");i[n]=t.val(),"font_family"!==n||_.isEmpty(i[n])||qazana.helpers.enqueueFont(i[n]),this.triggerMethod("value:change",i)}}),t.exports=n},{"qazana-panel/pages/schemes/items/base":55}],58:[function(e,t,i){var n;n=e("qazana-panel/pages/schemes/base").extend({getType:function(){return"typography"}}),t.exports=n},{"qazana-panel/pages/schemes/base":51}],59:[function(e,t,i){var n,r=e("qazana-layouts/edit-mode");n=Marionette.LayoutView.extend({template:"#tmpl-qazana-panel",id:"qazana-panel-inner",regions:{content:"#qazana-panel-content-wrapper",header:"#qazana-panel-header-wrapper",footer:"#qazana-panel-footer",modeSwitcher:"#qazana-mode-switcher"},pages:{},childEvents:{"click:add":function(){this.setPage("elements")},"editor:destroy":function(){this.setPage("elements")}},currentPageName:null,_isScrollbarInitialized:!1,initialize:function(){this.initPages()},buildPages:function(){var t={elements:{view:e("qazana-panel/pages/elements/elements"),title:'<img src="'+qazana.config.assets_url+'images/logo-panel.svg">'},editor:{view:e("qazana-panel/pages/editor")},menu:{view:e("qazana-panel/pages/menu/menu"),title:'<img src="'+qazana.config.assets_url+'images/logo-panel.svg">'},colorScheme:{view:e("qazana-panel/pages/schemes/colors")},typographyScheme:{view:e("qazana-panel/pages/schemes/typography")},colorPickerScheme:{view:e("qazana-panel/pages/schemes/color-picker")}},i=Object.keys(qazana.schemes.getSchemes()),n=_.difference(i,qazana.schemes.getEnabledSchemesTypes());return _.each(n,function(i){var n=qazana.schemes.getScheme(i);t[i+"Scheme"].view=e("qazana-panel/pages/schemes/disabled").extend({disabledTitle:n.disabled_title})}),t},initPages:function(){var e;this.getPages=function(t){return e||(e=this.buildPages()),t?e[t]:e},this.addPage=function(t,i){e||(e=this.buildPages()),e[t]=i}},getHeaderView:function(){return this.getChildView("header")},getFooterView:function(){return this.getChildView("footer")},getCurrentPageName:function(){return this.currentPageName},getCurrentPageView:function(){return this.getChildView("content")},setPage:function(e,t,i){var n=this.getPages(e);if(!n)throw new ReferenceError("Qazana panel doesn't have page named '"+e+"'");n.options&&(i=_.extend(n.options,i));var r=n.view;n.getView&&(r=n.getView()),this.showChildView("content",new r(i)),this.getHeaderView().setTitle(t||n.title),this.currentPageName=e},openEditor:function(e,t){if("editor"!==this.getCurrentPageName()||this.getCurrentPageView().model!==e){var i=qazana.getElementData(e);this.setPage("editor",qazana.translate("edit_element",[i.title]),{model:e,editedElementView:t});var n="panel/open_editor/"+e.get("elType");qazana.hooks.doAction(n,this,e,t),qazana.hooks.doAction(n+"/"+e.get("widgetType"),this,e,t)}},onBeforeShow:function(){var t=e("qazana-layouts/panel/footer"),i=e("qazana-layouts/panel/header");this.showChildView("modeSwitcher",new r),this.showChildView("header",new i),this.showChildView("footer",new t),this.updateScrollbar=_.throttle(this.updateScrollbar,100),this.getRegion("content").on("before:show",_.bind(this.onEditorBeforeShow,this)).on("empty",_.bind(this.onEditorEmpty,this)).on("show",_.bind(this.updateScrollbar,this)),this.setPage("elements"),this.listenTo(qazana.channels.data,"scrollbar:update",this.updateScrollbar)},onEditorBeforeShow:function(){_.defer(_.bind(this.updateScrollbar,this))},onEditorEmpty:function(){this.updateScrollbar()},updateScrollbar:function(){var e=this.content.$el;if(!this._isScrollbarInitialized)return e.perfectScrollbar(),void(this._isScrollbarInitialized=!0);e.perfectScrollbar("update")}}),t.exports=n},{"qazana-layouts/edit-mode":35,"qazana-layouts/panel/footer":36,"qazana-layouts/panel/header":37,"qazana-panel/pages/editor":38,"qazana-panel/pages/elements/elements":41,"qazana-panel/pages/menu/menu":49,"qazana-panel/pages/schemes/color-picker":52,"qazana-panel/pages/schemes/colors":53,"qazana-panel/pages/schemes/disabled":54,"qazana-panel/pages/schemes/typography":58}],60:[function(e,t,i){var n;n=Backbone.Model.extend({initialize:function(e,t){if(this.controls=t&&t.controls?t.controls:qazana.getElementControls(this),this.controls){var i=e||{},n={};_.each(this.controls,function(e){var t=qazana.config.controls[e.type];_.isObject(t.default_value)?n[e.name]=_.extend({},t.default_value,e.default||{}):n[e.name]=e.default||t.default_value}),this.defaults=n,i=_.defaults({},i,n),this.handleRepeaterData(i),this.set(i)}},handleRepeaterData:function(e){_.each(this.controls,function(t){"repeater"===t.type&&(e[t.name]instanceof Backbone.Collection||(e[t.name]=new Backbone.Collection(e[t.name],{model:function(e,i){return i=i||{},i.controls=t.fields,new n(e,i)}})))})},getFontControls:function(){return _.filter(this.getActiveControls(),function(e){return"font"===e.type})},getStyleControls:function(e){var t=this;return e=e||t.getActiveControls(),_.filter(e,function(i){return i.fields?(i.styleFields=t.getStyleControls(i.fields),!0):t.isStyleControl(i.name,e)})},isStyleControl:function(e,t){t=t||this.controls;var i=_.find(t,function(t){return e===t.name});return i&&!_.isEmpty(i.selectors)},isClassControl:function(e){var t=_.find(this.controls,function(t){return e===t.name});return t&&!_.isUndefined(t.prefix_class)},getControl:function(e){return _.find(this.controls,function(t){return e===t.name})},getActiveControls:function(){var e=this,t={};return _.each(e.controls,function(i,n){qazana.helpers.isActiveControl(i,e.attributes)&&(t[n]=i)}),t},clone:function(){return new n(qazana.helpers.cloneObject(this.attributes))},toJSON:function(){var e=Backbone.Model.prototype.toJSON.call(this);return delete e.widgetType,delete e.elType,delete e.isInner,_.each(e,function(t,i){t&&t.toJSON&&(e[i]=t.toJSON())}),e}}),t.exports=n},{}],61:[function(e,t,i){var n;n=e("qazana-models/base-settings").extend({defaults:{_inline_size:"",_column_size:100}}),t.exports=n},{"qazana-models/base-settings":60}],62:[function(e,t,i){var n,r,o=e("qazana-models/base-settings"),l=e("qazana-models/widget-settings"),s=e("qazana-models/column-settings"),a=e("qazana-models/section-settings");n=Backbone.Model.extend({defaults:{id:"",elType:"",isInner:!1,settings:{},defaultEditSettings:{}},remoteRender:!1,_htmlCache:null,_jqueryXhr:null,renderOnLeave:!1,initialize:function(e){var t=this.get("elType"),i=this.get("elements");void 0!==i&&this.set("elements",new r(i)),"widget"===t&&(this.remoteRender=!0,this.setHtmlCache(e.htmlCache||"")),delete e.htmlCache,this.renderRemoteServer=_.throttle(this.renderRemoteServer,1e3),this.initSettings(),this.initEditSettings(),this.on({destroy:this.onDestroy,"editor:close":this.onCloseEditor})},initSettings:function(){var e=this.get("elType"),t={widget:l,column:s,section:a}[e]||o,i=this.get("settings")||{};"widget"===e&&(i.widgetType=this.get("widgetType")),i.elType=e,i.isInner=this.get("isInner"),i=new t(i),this.set("settings",i),qazanaFrontend.config.elements.data[this.cid]=i},initEditSettings:function(){this.set("editSettings",new Backbone.Model(this.get("defaultEditSettings")))},onDestroy:function(){var e=this.get("settings"),t=this.get("elements");void 0!==t&&_.each(_.clone(t.models),function(e){e.destroy()}),e instanceof o&&e.destroy()},onCloseEditor:function(){this.initEditSettings(),this.renderOnLeave&&this.renderRemoteServer()},setSetting:function(e,t,i){i=i||!1;var n=this.get("settings");n.set(e,t),this.set("settings",n),i&&(this.trigger("change",this),this.trigger("change:settings",this),this.trigger("change:settings:"+e,this))},getSetting:function(e){var t=this.get("settings");return void 0===t.get(e)?"":t.get(e)},setHtmlCache:function(e){this._htmlCache=e},getHtmlCache:function(){return this._htmlCache},getTitle:function(){var e=qazana.getElementData(this);return e?e.title:"Unknown"},getIcon:function(){var e=qazana.getElementData(this);return e?e.icon:"unknown"},getRemoteRenderRequest:function(){var e=this.toJSON();return qazana.ajax.send("render_widget",{data:{post_id:qazana.config.post_id,data:JSON.stringify(e),_nonce:qazana.config.nonce},success:_.bind(this.onRemoteGetHtml,this)})},renderRemoteServer:function(){this.remoteRender&&(this.renderOnLeave=!1,this.trigger("before:remote:render"),this._jqueryXhr&&4!==this._jqueryXhr&&this._jqueryXhr.abort(),this._jqueryXhr=this.getRemoteRenderRequest())},onRemoteGetHtml:function(e){this.setHtmlCache(e.render),this.trigger("remote:render")},clone:function(){var e=Backbone.Model.prototype.clone.apply(this,arguments);e.set("id",qazana.helpers.getUniqueID()),e.setHtmlCache(this.getHtmlCache());var t=this.get("elements"),i=this.get("settings");return _.isEmpty(t)||e.set("elements",t.clone()),i instanceof o&&e.set("settings",i.clone()),e},toJSON:function(e){e=_.extend({copyHtmlCache:!1},e);var t=Backbone.Model.prototype.toJSON.call(this);return _.each(t,function(i,n){i&&i.toJSON&&(t[n]=i.toJSON(e))}),e.copyHtmlCache?t.htmlCache=this.getHtmlCache():delete t.htmlCache,t}}),(r=Backbone.Collection.extend({add:function(e,t,i){if(!(t&&t.silent||i))throw"Call Error: Adding model to element collection is allowed only by the dedicated addChildModel() method.";return Backbone.Collection.prototype.add.call(this,e,t)},model:function(e,t){var i=Backbone.Model;return e.elType&&(i=qazana.hooks.applyFilters("element/model",n,e)),new i(e,t)},clone:function(){var e=Backbone.Collection.prototype.clone.apply(this,arguments),t=new r;return e.forEach(function(e){t.add(e.clone(),null,!0)}),t}})).prototype.sync=function(){return null},r.prototype.fetch=function(){return null},r.prototype.save=function(){return null},n.prototype.sync=function(){return null},n.prototype.fetch=function(){return null},n.prototype.save=function(){return null},t.exports={Model:n,Collection:r}},{"qazana-models/base-settings":60,"qazana-models/column-settings":61,"qazana-models/section-settings":63,"qazana-models/widget-settings":64}],63:[function(e,t,i){var n;n=e("qazana-models/base-settings").extend({defaults:{}}),t.exports=n},{"qazana-models/base-settings":60}],64:[function(e,t,i){var n;n=e("qazana-models/base-settings").extend({}),t.exports=n},{"qazana-models/base-settings":60}],65:[function(e,t,i){var n;n={config:{},initConfig:function(){this.config={ajaxParams:{type:"POST",url:qazana.config.ajaxurl,data:{}},actionPrefix:"qazana_"}},init:function(){this.initConfig()},send:function(e,t){var i=qazana.helpers.cloneObject(this.config.ajaxParams);t=t||{},e=this.config.actionPrefix+e,Backbone.$.extend(i,t),i.data instanceof FormData?(i.data.append("action",e),i.data.append("_nonce",qazana.config.nonce)):(i.data.action=e,i.data._nonce=qazana.config.nonce);var n=i.success,r=i.error;return(n||r)&&(i.success=function(e){e.success&&n&&n(e.data),!e.success&&r&&r(e.data)},r&&(i.error=function(e){r(e)})),Backbone.$.ajax(i)}},t.exports=n},{}],66:[function(e,t,i){var n;n=function(){var e=this;this.compare=function(e,t,i){switch(i){case"==":return e==t;case"!=":return e!=t;case"!==":return e!==t;case"in":return-1!==t.indexOf(e);case"!in":return-1===t.indexOf(e);case"<":return e<t;case"<=":return e<=t;case">":return e>t;case">=":return e>=t;default:return e===t}},this.check=function(t,i){var n="or"===t.relation,r=!n;return Backbone.$.each(t.terms,function(){var t,o=this;if(o.terms)t=e.check(o,i);else{var l=o.name.match(/(\w+)(?:\[(\w+)])?/),s=i[l[1]];l[2]&&(s=s[l[2]]),t=e.compare(s,o.value,o.operator)}return n?(t&&(r=!0),!t):t?void 0:r=!1}),r}},t.exports=new n},{}],67:[function(e,t,i){var n;n={init:function(){var e;this.getModal=function(){return e||(e=this.initModal()),e},Backbone.$(document).on({"heartbeat-send":function(e,t){t.qazana_post_lock={post_ID:qazana.config.post_id}},"heartbeat-tick":function(e,t){t.locked_user?(qazana.isEditorChanged()&&qazana.saveEditor({status:"autosave"}),n.showLockMessage(t.locked_user)):n.getModal().hide(),qazana.config.nonce=t.qazana_nonce}}),qazana.config.locked_user&&n.showLockMessage(qazana.config.locked_user)},initModal:function(){var e=qazana.dialogsManager.createWidget("options",{headerMessage:qazana.translate("take_over")});return e.addButton({name:"go_back",text:qazana.translate("go_back"),callback:function(){parent.history.go(-1)}}),e.addButton({name:"take_over",text:qazana.translate("take_over"),callback:function(){wp.heartbeat.enqueue("qazana_force_post_lock",!0),wp.heartbeat.connectNow()}}),e},showLockMessage:function(e){n.getModal().setMessage(qazana.translate("dialog_user_taken_over",[e])).show()}},t.exports=n},{}],68:[function(e,t,i){var n;n={_enqueuedFonts:[],elementsHierarchy:{section:{column:{widget:null,section:null}}},enqueueFont:function(e){if(-1===this._enqueuedFonts.indexOf(e)){var t,i={ru_RU:"cyrillic",uk:"cyrillic",bg_BG:"cyrillic",vi:"vietnamese",el:"greek",he_IL:"hebrew"};switch(qazana.config.controls.font.fonts[e]){case"googlefonts":t="https://fonts.googleapis.com/css?family="+e+":100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic",i[qazana.config.locale]&&(t+="&subset="+i[qazana.config.locale]);break;case"earlyaccess":t="https://fonts.googleapis.com/earlyaccess/"+e.replace(/\s+/g,"").toLowerCase()+".css"}_.isEmpty(t)||qazana.$previewContents.find("link:last").after('<link href="'+t+'" rel="stylesheet" type="text/css">'),this._enqueuedFonts.push(e)}},getElementChildType:function(e,t){if(t||(t=this.elementsHierarchy),void 0!==t[e])return Backbone.$.isPlainObject(t[e])?Object.keys(t[e]):null;for(var i in t)if(t.hasOwnProperty(i)&&Backbone.$.isPlainObject(t[i])){var n=this.getElementChildType(e,t[i]);if(n)return n}return null},getUniqueID:function(){return Math.random().toString(36).substr(2,7)},stringReplaceAll:function(e,t){var i=new RegExp(Object.keys(t).join("|"),"gi");return e.replace(i,function(e){return t[e]})},cloneObject:function(e){return JSON.parse(JSON.stringify(e))},getYoutubeIDFromURL:function(e){var t=e.match(/^.*(?:youtu.be\/|v\/|e\/|u\/\w+\/|embed\/|v=)([^#\&\?]*).*/);return t&&t[1]},ytVidId:function(e){var t=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;return!!e.match(t)&&RegExp.$1},isActiveControl:function(e,t){var i;if(i=_.isFunction(e.get)?e.get("condition"):e.condition,e.conditions)return qazana.conditions.check(e.conditions,t);if(_.isEmpty(i))return!0;var n=_.filter(i,function(e,i){var n=i.match(/([a-z_0-9]+)(?:\[([a-z_]+)])?(!?)$/i),r=n[1],o=n[2],l=!!n[3],s=t[r];o&&_.isArray(s)&&(s=s[o]);var a;return a=_.isArray(e)&&!_.isEmpty(e)?_.contains(e,s):_.isArray(s)&&!_.isEmpty(s)?_.contains(s,e):_.isEqual(e,s),l?a:!a});return _.isEmpty(n)},disableElementEvents:function(e){e.each(function(){var e=this.style.pointerEvents;"none"!==e&&Backbone.$(this).data("backup-pointer-events",e).css("pointer-events","none")})},enableElementEvents:function(e){e.each(function(){var e=Backbone.$(this),t=e.data("backup-pointer-events");void 0!==t&&e.removeData("backup-pointer-events").css("pointer-events",t)})},getColorPickerPaletteIndex:function(e){return["7","8","1","5","2","3","6","4"].indexOf(e)},wpColorPicker:function(e,t){var i=this,n=qazana.schemes.getScheme("color-picker"),r=_.sortBy(n.items,function(e){return i.getColorPickerPaletteIndex(e.key)}),o={width:window.innerWidth>=1440?271:251,palettes:_.pluck(r,"value")};return t&&_.extend(o,t),e.wpColorPicker(o)}},t.exports=n},{}],69:[function(e,t,i){t.exports=new function(e){var t=this,i={},n={del:46,d:68,l:76,m:77,p:80,s:83},r=function(){return-1!==navigator.userAgent.indexOf("Mac OS X")},o=function(){i[n.del]={deleteElement:{isWorthHandling:function(t){var i="editor"===qazana.getPanelView().getCurrentPageName(),n=e(t.target).is(":input");return i&&!n},handle:function(){qazana.getPanelView().getCurrentPageView().getOption("editedElementView").confirmRemove()}}},i[n.d]={},i[n.l]={showTemplateLibrary:{isWorthHandling:function(e){return t.isControlEvent(e)&&e.shiftKey},handle:function(){qazana.templates.showTemplatesModal()}}},i[n.m]={changeDeviceMode:{devices:["desktop","tablet","mobile"],isWorthHandling:function(e){return t.isControlEvent(e)&&e.shiftKey},handle:function(){var e=qazana.channels.deviceMode.request("currentMode"),t=this.devices.indexOf(e);++t>=this.devices.length&&(t=0),qazana.changeDeviceMode(this.devices[t])}}},i[n.p]={changeEditMode:{isWorthHandling:function(e){return t.isControlEvent(e)},handle:function(){qazana.getPanelView().modeSwitcher.currentView.toggleMode()}}},i[n.s]={saveEditor:{isWorthHandling:function(e){return t.isControlEvent(e)},handle:function(){qazana.getPanelView().getFooterView()._publishQazana()}}}},l=function(e){var t=i[e.which];t&&_.each(t,function(t){t.isWorthHandling&&!t.isWorthHandling(e)||(e.preventDefault(),t.handle(e))})},s=function(){t.bindListener(qazana.$window)};this.isControlEvent=function(e){return e[r()?"metaKey":"ctrlKey"]},this.addHotKeyHandler=function(e,t,n){i[e]||(i[e]={}),i[e][t]=n},this.bindListener=function(e){e.on("keydown",l)},this.init=function(){o(),s()}}(jQuery)},{}],70:[function(e,t,i){var n;n=function(){var e=this,t={},i=[],n=function(e){var t,i=e.size;if("custom"===i){var n=e.dimension;if(!n.width&&!n.height)return"full";t="custom_"+n.width+"x"+n.height}else t=i;return t};e.onceTriggerChange=_.once(function(e){window.setTimeout(function(){e.get("settings").trigger("change")},700)}),e.getImageUrl=function(t){e.registerItem(t);var i=e.getItem(t);if(!i){if("custom"===t.size)return void(qazana.getPanelView()&&"editor"===qazana.getPanelView().currentPageName&&t.model&&e.onceTriggerChange(t.model));i=t.url}return i},e.getItem=function(e){var i=n(e),r=e.id;return!!i&&(!(!t[r]||!t[r][i])&&t[r][i])},e.registerItem=function(t){""!==t.id&&(e.getItem(t)||(i.push(t),e.debounceGetRemoteItems()))},e.getRemoteItems=function(){var e,r,o=[],l=Object.keys(i).length;if(0!==l){if(1===l){for(r in i){e=i[r];break}if(e&&e.model)return void e.model.renderRemoteServer()}for(r in i){e=i[r];var s=n(e),a=e.id,d=!t[a]||0===Object.keys(t[a]).length;o.push({id:a,size:s,is_first_time:d})}window.qazana.ajax.send("get_images_details",{data:{items:o},success:function(e){var n,r;for(n in e){t[n]||(t[n]={});for(r in e[n])t[n][r]=e[n][r]}i=[]}})}},e.debounceGetRemoteItems=_.debounce(e.getRemoteItems,300)},t.exports=new n},{}],71:[function(e,t,i){!function(e){var t=function(e){try{return e.originalEvent.dataTransfer.setData("test","test"),e.originalEvent.dataTransfer.clearData("test"),!0}catch(e){return!1}},i={html5Draggable:function(i){var n=this,r={},o={},l={element:"",groups:null,onDragStart:null,onDragEnd:null},s=function(){e.extend(!0,r,l,i)},a=function(){o.$element=e(r.element)},d=function(){o.$element.attr("draggable",!0)},u=function(t){e.isFunction(r.onDragEnd)&&r.onDragEnd.call(o.$element,t,n)},c=function(i){var l={groups:r.groups||[]};t(i)&&i.originalEvent.dataTransfer.setData(JSON.stringify(l),!0),e.isFunction(r.onDragStart)&&r.onDragStart.call(o.$element,i,n)},h=function(){o.$element.on("dragstart",c).on("dragend",u)};this.destroy=function(){o.$element.off("dragstart",c),o.$element.removeAttr("draggable")},s(),a(),d(),h()},html5Droppable:function(i){var n=this,r={},o={},l={element:"",items:">",horizontalSensitivity:"10%",axis:["vertical","horizontal"],groups:null,isDroppingAllowed:null,onDragEnter:null,onDragging:null,onDropping:null,onDragLeave:null},s=function(){e.extend(r,l,i)},a=function(){o.$element=e(r.element)},d=function(){return-1!==r.axis.indexOf("horizontal")},u=function(){return-1!==r.axis.indexOf("vertical")},c=function(e,t){var i;return!!d()&&(u()?!!(i=r.horizontalSensitivity.match(/\d+/))&&(i=i[0],/%$/.test(r.horizontalSensitivity)&&(i=t/i),e>t-i?"right":e<i&&"left"):e>t/2?"right":"left")},h=function(t,i){var n,r,o,l;return i=i.originalEvent,n=e(t),r=n.outerHeight(),o=n.outerWidth(),(l=c(i.offsetX,o))?l:!!u()&&(l=i.offsetY>r/2?"bottom":"top")},p=function(i,o,l){var s,a,d;return!(r.groups&&t(l)&&(s=l.originalEvent.dataTransfer.types,d=!1,(s=Array.prototype.slice.apply(s)).forEach(function(e){try{if(!(a=JSON.parse(e)).groups.slice)return;r.groups.forEach(function(e){if(-1!==a.groups.indexOf(e))return d=!0,!1})}catch(e){}}),!d))&&!(e.isFunction(r.isDroppingAllowed)&&!r.isDroppingAllowed.call(i,o,l,n))},g=function(t){if(t.target===this){e(this).children().each(function(){var t=this.style.pointerEvents;"none"!==t&&e(this).data("backup-pointer-events",t).css("pointer-events","none")});var i=h(this,t);p(this,i,t)&&e.isFunction(r.onDragEnter)&&r.onDragEnter.call(this,i,t,n)}},m=function(t){var i=h(this,t);p(this,i,t)&&(t.preventDefault(),e.isFunction(r.onDragging)&&r.onDragging.call(this,i,t,n))},b=function(t){var i=h(this,t);p(this,i,t)&&(t.preventDefault(),e.isFunction(r.onDropping)&&r.onDropping.call(this,i,t,n))},f=function(t){e(this).children().each(function(){var t=e(this),i=t.data("backup-pointer-events");void 0!==i&&t.removeData("backup-pointer-events").css("pointer-events",i)}),e.isFunction(r.onDragLeave)&&r.onDragLeave.call(this,t,n)},v=function(){o.$element.on("dragenter",r.items,g).on("dragover",r.items,m).on("drop",r.items,b).on("dragleave drop",r.items,f)};this.destroy=function(){o.$element.off("dragenter",r.items,g).off("dragover",r.items,m).off("drop",r.items,b).off("dragleave drop",r.items,f)},s(),a(),v()}};e.each(i,function(t,i){e.fn[t]=function(n){return n=n||{},this.each(function(){var r=e.data(this,t);r instanceof i?"destroy"===n&&(r.destroy(),e.removeData(this,t)):(n.element=this,e.data(this,t,new i(n)))}),this}})}(jQuery)},{}],72:[function(e,t,i){!function(e){e.fn.qazanaSerializeObject=function(){var t=this.serializeArray(),i={},n=function(e,t,i){var r=/^[^\[\]]+\[]/.test(t),o=/^[^\[\]]+\[[^\[\]]+]/.test(t),l=t.replace(/\[.*/,"");if(r)e[l]||(e[l]=[]);else{if(!o)return void(e.push?e.push(i):e[l]=i);e[l]||(e[l]={})}var s=t.match(/\[[^\[\]]*]/g);return s[0]=s[0].replace(/\[|]/g,""),n(e[l],s.join(""),i)};return e.each(t,function(){n(i,this.name,this.value)}),i}}(jQuery)},{}],73:[function(e,t,i){var n;n={init:function(){this.initModalWidgetType()},initModalWidgetType:function(){var e={getDefaultSettings:function(){var e=DialogsManager.getWidgetType("options").prototype.getDefaultSettings.apply(this,arguments);return _.extend(e,{position:{my:"center",at:"center"},contentWidth:"auto",contentHeight:"auto",closeButton:!0})},buildWidget:function(){if(DialogsManager.getWidgetType("options").prototype.buildWidget.apply(this,arguments),this.getSettings("closeButton")){var e=this.addElement("closeButton",'<div><i class="fa fa-times"></i></div>');this.getElements("widgetContent").prepend(e)}},attachEvents:function(){this.getSettings("closeButton")&&this.getElements("closeButton").on("click",this.hide)},onReady:function(){DialogsManager.getWidgetType("options").prototype.onReady.apply(this,arguments);var e=this.getElements(),t=this.getSettings();"auto"!==t.contentWidth&&e.message.width(t.contentWidth),"auto"!==t.contentHeight&&e.message.height(t.contentHeight)}};DialogsManager.addWidgetType("qazana-modal",DialogsManager.getWidgetType("options").extend("qazana-modal",e))}},t.exports=n},{}],74:[function(e,t,i){var n;n={getPresetsDictionary:function(){return{11:100/9,12:12.5,14:100/7,16:100/6,33:100/3,66:2/3*100,83:5/6*100}},getAbsolutePresetValues:function(e){var t=qazana.helpers.cloneObject(e),i=this.getPresetsDictionary();return _.each(t,function(e,n){i[e]&&(t[n]=i[e])}),t},getPresets:function(e,t){var i=qazana.helpers.cloneObject(qazana.config.elements.section.presets);return e&&(i=i[e]),t&&(i=i[t]),i},getPresetByStructure:function(e){var t=this.getParsedStructure(e);return this.getPresets(t.columnsCount,t.presetIndex)},getParsedStructure:function(e){return e+="",{columnsCount:e.slice(0,-1),presetIndex:e.substr(-1)}},getPresetSVG:function(e,t,i,n){t=t||100,i=i||50,n=n||2;var r=this.getAbsolutePresetValues(e),o=this._generatePresetSVGPath(r,t,i,n);return this._createSVGPreset(o,t,i)},_createSVGPreset:function(e,t,i){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),n.setAttribute("viewBox","0 0 "+t+" "+i);var r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),n.appendChild(r),n},_generatePresetSVGPath:function(e,t,i,n){for(var r=t-n*(e.length-1),o=0,l="",s=0;s<e.length;s++){s&&(l+=" ");var a=e[s]/100*r;l+="M"+ +(o+=a).toFixed(4)+",0",l+="V"+i,l+="H"+ +(o-a).toFixed(4),l+="V0Z",o+=n}return l}},t.exports=n},{}],75:[function(e,t,i){var n,r=e("qazana-utils/stylesheet"),o=e("qazana-views/base-element");n=function(){var e=this,t=new r,i={},n={selectorWrapperPrefix:".qazana-widget-"},l={},s=function(){l.$previewHead.append(l.$style)},a=function(){l.$style=Backbone.$("<style>",{id:"qazana-style-scheme"}),l.$previewHead=qazana.$previewContents.find("head")},d=function(){i=qazana.helpers.cloneObject(qazana.config.schemes.items)},u=function(i,r,l){o.addControlStyleRules(t,i,r,function(t){return e.getSchemeValue(t.scheme.type,t.scheme.value,t.scheme.key).value},["{{WRAPPER}}"],[n.selectorWrapperPrefix+l])},c=function(t){var i=e.getWidgetSchemeControls(t);_.each(i,function(e){u(e,i,t.widget_type)})},h=function(){_.each(qazana.config.widgets,function(e){c(e)})};this.init=function(){return a(),s(),d(),e},this.getWidgetSchemeControls=function(e){return _.filter(e.controls,function(e){return _.isObject(e.scheme)})},this.getSchemes=function(){return i},this.getEnabledSchemesTypes=function(){return qazana.config.schemes.enabled_schemes},this.getScheme=function(e){return i[e]},this.getSchemeValue=function(t,i,n){if(this.getEnabledSchemesTypes().indexOf(t)<0)return!1;var r=e.getScheme(t).items[i];if(n&&_.isObject(r)){var o=qazana.helpers.cloneObject(r);return o.value=r.value[n],o}return r},this.printSchemesStyle=function(){t.empty(),h(),l.$style.text(t)},this.resetSchemes=function(e){i[e]=qazana.helpers.cloneObject(qazana.config.schemes.items[e])},this.saveScheme=function(e){qazana.config.schemes.items[e].items=qazana.helpers.cloneObject(i[e].items);var t={};_.each(i[e].items,function(e,i){t[i]=e.value}),NProgress.start(),qazana.ajax.send("apply_scheme",{data:{scheme_name:e,data:JSON.stringify(t)},success:function(){NProgress.done()}})},this.setSchemeValue=function(e,t,n){i[e].items[t].value=n}},t.exports=new n},{"qazana-utils/stylesheet":76,"qazana-views/base-element":77}],76:[function(e,t,i){!function(e){var i=function(){var t=this,n={},r={},o=function(e){var t=Object.keys(r),i=t.indexOf(e)+1;if(i>=t.length)throw new RangeError("Max value for this device is out of range.");return r[t[i]]-1},l=function(t){var i=[];return e.each(t,function(e){i.push(e+"_"+this)}),i.join("-")},s=function(e){var t={};return(e=e.split("-").filter(String)).forEach(function(e){var i=e.split("_"),n=i[0],l=i[1];t[n]="max"===n?o(l):r[l]}),t},a=function(e){n[e]={};var t=Object.keys(n);if(!(t.length<2)){t.sort(function(e,t){if("all"===e)return-1;if("all"===t)return 1;var i=s(e);return s(t).max-i.max});var i={};t.forEach(function(e){i[e]=n[e]}),n=i}},d=function(t){var i=s(t),n=[];return e.each(i,function(e){n.push("("+e+"-width:"+this+"px)")}),"@media"+n.join(" and ")};this.addDevice=function(e,i){r[e]=i;var n=Object.keys(r);if(n.length<2)return t;n.sort(function(e,t){return r[e]-r[t]});var o={};return n.forEach(function(e){o[e]=r[e]}),r=o,t},this.addRules=function(i,r,o){var s="all";if(o&&(s=l(o)),n[s]||a(s),r){if(n[s][i]||(n[s][i]={}),"string"==typeof r){r=r.split(";").filter(String);var d={};e.each(r,function(){var e=this.split(/:(.*)?/);d[e[0].trim()]=e[1].trim().replace(";","")}),r=d}return e.extend(n[s][i],r),t}var u=i.match(/[^\s\\].+?(?=\{)\{.+?(?=})}/g);e.each(u,function(){var e=this.match(/(.+?(?=\{))\{(.+?(?=}))}/);t.addRules(e[1],e[2],o)})},this.getRules=function(){return n},this.empty=function(){n={}},this.toString=function(){var t="";return e.each(n,function(e){var n=i.parseRules(this);"all"!==e&&(n=d(e)+"{"+n+"}"),t+=n}),t}};i.parseRules=function(t){var n="";return e.each(t,function(e){var t=i.parseProperties(this);t&&(n+=e+"{"+t+"}")}),n},i.parseProperties=function(t){var i="";return e.each(t,function(e){this&&(i+=e+":"+this+";")}),i},t.exports=i}(jQuery)},{}],77:[function(e,t,i){var n,r=e("qazana-models/base-settings"),o=e("qazana-utils/stylesheet");n=Marionette.CompositeView.extend({tagName:"div",stylesheet:null,className:function(){return this.getElementUniqueID()},attributes:function(){var e=this.model.get("elType");return"widget"===e&&(e=this.model.get("widgetType")),{"data-element_type":e}},ui:function(){return{duplicateButton:"> .qazana-editor-element-settings .qazana-editor-element-duplicate",removeButton:"> .qazana-editor-element-settings .qazana-editor-element-remove",saveButton:"> .qazana-editor-element-settings .qazana-editor-element-save"}},events:function(){return{"click @ui.removeButton":"onClickRemove","click @ui.saveButton":"onClickSave","click @ui.duplicateButton":"duplicate"}},$stylesheetElement:null,getElementType:function(){return this.model.get("elType")},getChildType:function(){return qazana.helpers.getElementChildType(this.getElementType())},getChildView:function(t){var i,n=t.get("elType");return i="section"===n?e("qazana-views/section"):"column"===n?e("qazana-views/column"):qazana.modules.WidgetView,qazana.hooks.applyFilters("element/view",i,t,this)},templateHelpers:function(){return{elementModel:this.model,editModel:this.getEditModel()}},getTemplateType:function(){return"js"},getEditModel:function(){return this.model},initialize:function(){this.collection=this.model.get("elements"),this.collection&&(this.listenTo(this.collection,"add remove reset",this.onCollectionChanged,this),this.listenTo(this.collection,"switch",this.handleElementHover,this));var e=this.getEditModel();this.listenTo(e.get("settings"),"change",this.onSettingsChanged,this),this.listenTo(e.get("editSettings"),"change",this.onSettingsChanged,this),this.on("render",function(){this.renderUI(),this.runReadyTrigger()}),this.initRemoveDialog(),this.initStylesheet()},handleElementHover:function(){var e=this,t={class:"qazana-element-settings-active"},i={sensitivity:1,interval:10,timeout:500,over:function(){e.$el.addClass(t.class)},out:function(){e.$el.removeClass(t.class)}};e.$el.hoverIntent(i)},edit:function(){qazana.getPanelView().openEditor(this.getEditModel(),this)},addChildModel:function(e,t){return this.collection.add(e,t,!0)},addChildElement:function(e,t){if(t=t||{},-1===this.getChildType().indexOf(e.elType))return delete t.at,this.children.last().addChildElement(e,t);var i=this.addChildModel(e,t),n=this.children.findByModel(i);return"section"===n.getElementType()&&n.isInner()&&n.addEmptyColumn(),n.edit(),n},addElementFromPanel:function(e){var t=qazana.channels.panelElements.request("element:selected"),i={id:qazana.helpers.getUniqueID(),elType:t.model.get("elType")};if("widget"===i.elType)i.widgetType=t.model.get("widgetType");else{if("section"!==i.elType)return;i.elements=[],i.isInner=!0}var n=t.model.get("custom");n&&_.extend(i,n),this.addChildElement(i,e)},isCollectionFilled:function(){return!1},isInner:function(){return!!this.model.get("isInner")},initRemoveDialog:function(){var e;this.getRemoveDialog=function(){if(!e){var t=this.model.getTitle();e=qazana.dialogsManager.createWidget("confirm",{message:qazana.translate("dialog_confirm_delete",[t.toLowerCase()]),headerMessage:qazana.translate("delete_element",[t]),strings:{confirm:qazana.translate("delete"),cancel:qazana.translate("cancel")},defaultOption:"confirm",onConfirm:_.bind(function(){this.model.destroy()},this)})}return e}},initStylesheet:function(){var e=qazana.config.viewportBreakpoints;this.stylesheet=new o,this.stylesheet.addDevice("mobile",0).addDevice("tablet",e.md).addDevice("desktop",e.lg)},createStylesheetElement:function(){this.$stylesheetElement=Backbone.$("<style>",{id:"qazana-style-"+this.model.cid}),qazana.$previewContents.find("head").append(this.$stylesheetElement)},enqueueFonts:function(){var e=this.getEditModel(),t=e.get("settings");_.each(t.getFontControls(),_.bind(function(t){var i=e.getSetting(t.name);_.isEmpty(i)||qazana.helpers.enqueueFont(i)},this))},addStyleRules:function(e,t,i,n){var r=this;_.each(e,function(e){e.styleFields&&t[e.name].each(function(t){r.addStyleRules(e.styleFields,t.attributes,i.concat(["{{CURRENT_ITEM}}"]),n.concat([".qazana-repeater-item-"+t.get("_id")]))}),r.addControlStyleRules(e,t,r.getEditModel().get("settings").controls,i,n)})},addControlStyleRules:function(e,t,i,r,o){var l=this;n.addControlStyleRules(l.stylesheet,e,i,function(e){return l.getStyleControlValue(e,t)},r,o)},addStyleToDocument:function(){var e=this.stylesheet.toString();e=qazana.hooks.applyFilters("editor/style/styleText",e,this),_.isEmpty(e)&&!this.$stylesheetElement||(this.$stylesheetElement||this.createStylesheetElement(),this.$stylesheetElement.text(e))},getStyleControlValue:function(e,t){var i=t[e.name];if(e.selectors_dictionary&&(i=e.selectors_dictionary[i]||i),_.isNumber(i)||!_.isEmpty(i))return i},renderStyles:function(){var e=this,t=e.getEditModel().get("settings");if(e.stylesheet.empty(),e.addStyleRules(t.getStyleControls(),t.attributes,[/\{\{WRAPPER}}/g],["#qazana ."+e.getElementUniqueID()]),"column"===e.model.get("elType")){var i=t.get("_inline_size");_.isEmpty(i)||e.stylesheet.addRules("#qazana ."+e.getElementUniqueID(),{width:i+"%"},{min:"tablet"})}e.addStyleToDocument()},renderCustomClasses:function(){var e=this;e.$el.addClass("qazana-element");var t=e.getEditModel().get("settings");_.each(t.attributes,function(i,n){if(t.isClassControl(n)){var r=t.getControl(n),o=t.previous(n),l=i;r.classes_dictionary&&(void 0!==r.classes_dictionary[o]&&(o=r.classes_dictionary[o]),void 0!==r.classes_dictionary[i]&&(l=r.classes_dictionary[i])),e.$el.removeClass(r.prefix_class+o),qazana.helpers.isActiveControl(r,t.attributes)&&!_.isEmpty(l)&&e.$el.addClass(r.prefix_class+l).addClass(_.result(e,"className"))}})},renderUI:function(){this.renderStyles(),this.renderCustomClasses(),this.enqueueFonts()},runReadyTrigger:function(){_.defer(_.bind(function(){qazanaFrontend.elementsHandler.runReadyTrigger(this.$el)},this))},getElementUniqueID:function(){return"qazana-element-"+this.model.get("id")},duplicate:function(e){e.preventDefault(),this.trigger("request:duplicate")},confirmRemove:function(){this.getRemoveDialog().show()},onClickEdit:function(e){e.preventDefault(),e.stopPropagation(),"edit"===qazana.channels.dataEditMode.request("activeMode")&&this.edit()},onCollectionChanged:function(){qazana.setFlagEditorChange(!0)},onSettingsChanged:function(e){var t=this.getEditModel();if(t.get("editSettings")!==e&&qazana.setFlagEditorChange(!0),e instanceof r){var i=!1;if(_.each(e.changedAttributes(),function(t,n){var r=e.getControl(n);r&&(r.force_render||!e.isStyleControl(n)&&!e.isClassControl(n))&&(i=!0)}),!i)return void this.renderUI()}"js"===this.getTemplateType()?(this.getEditModel().setHtmlCache(),this.render(),t.renderOnLeave=!0):t.renderRemoteServer()},onClickRemove:function(e){e.preventDefault(),e.stopPropagation(),this.confirmRemove()},onClickSave:function(e){e.preventDefault();var t=this.model;qazana.templates.startModal(function(){qazana.templates.getLayout().showSaveTemplateView(t)})},onDestroy:function(){this.$stylesheetElement&&this.$stylesheetElement.remove()}},{addControlStyleRules:function(e,t,i,n,r,o){var l=n(t);void 0!==l&&_.each(t.selectors,function(s,a){var d;try{d=s.replace(/\{\{(?:([^.}]+)\.)?([^}]*)}}/g,function(e,r,o){var s=t,a=l;r&&(s=_.findWhere(i,{name:r}),a=n(s));var d=qazana.getControlItemView(s.type).getStyleValue(o.toLowerCase(),a);if(""===d)throw"";return d})}catch(e){return}if(!_.isEmpty(d)){var u=/^\(([^)]+)\)/,c=a.match(u);c&&(a=a.replace(u,""),c=c[1]),_.each(r,function(e,t){a=a.replace(e,o[t])});var h,p=c;!p&&t.responsive&&(p=t.responsive),p&&"desktop"!==p&&(h={max:p}),e.addRules(a,d,h)}})}}),t.exports=n},{"qazana-models/base-settings":60,"qazana-utils/stylesheet":76,"qazana-views/column":79,"qazana-views/section":108}],78:[function(e,t,i){var n,r=e("qazana-views/section");n=Marionette.CompositeView.extend({childView:r,behaviors:{Sortable:{behaviorClass:e("qazana-behaviors/sortable"),elChildType:"section"},HandleDuplicate:{behaviorClass:e("qazana-behaviors/handle-duplicate")},HandleAdd:{behaviorClass:e("qazana-behaviors/duplicate")}},getSortableOptions:function(){return{handle:"> .qazana-container > .qazana-row > .qazana-column > .qazana-element-overlay .qazana-editor-section-settings-list .qazana-editor-element-trigger",items:"> .qazana-section"}},getChildType:function(){return["section"]},isCollectionFilled:function(){return!1},initialize:function(){this.listenTo(this.collection,"add remove reset",this.onCollectionChanged).listenTo(qazana.channels.panelElements,"element:drag:start",this.onPanelElementDragStart).listenTo(qazana.channels.panelElements,"element:drag:end",this.onPanelElementDragEnd)},addChildModel:function(e,t){return this.collection.add(e,t,!0)},addSection:function(e){var t={id:qazana.helpers.getUniqueID(),elType:"section",settings:{},elements:[]};e&&_.extend(t,e);var i=this.addChildModel(t);return this.children.findByModelCid(i.cid)},onCollectionChanged:function(){qazana.setFlagEditorChange(!0)},onPanelElementDragStart:function(){qazana.helpers.disableElementEvents(this.$el.find("iframe"))},onPanelElementDragEnd:function(){qazana.helpers.enableElementEvents(this.$el.find("iframe"))}}),t.exports=n},{"qazana-behaviors/duplicate":1,"qazana-behaviors/handle-duplicate":3,"qazana-behaviors/sortable":6,"qazana-views/section":108}],79:[function(e,t,i){var n,r=e("qazana-views/base-element"),o=e("qazana-views/element-empty");n=r.extend({template:Marionette.TemplateCache.get("#tmpl-qazana-element-column-content"),emptyView:o,childViewContainer:"> .qazana-column-wrap > .qazana-widget-wrap",behaviors:{Sortable:{behaviorClass:e("qazana-behaviors/sortable"),elChildType:"widget"},Resizable:{behaviorClass:e("qazana-behaviors/resizable")},HandleDuplicate:{behaviorClass:e("qazana-behaviors/handle-duplicate")},HandleEditToolsSection:{behaviorClass:e("qazana-behaviors/edit-tools-section")},HandleAddMode:{behaviorClass:e("qazana-behaviors/duplicate")}},className:function(){return r.prototype.className.apply(this,arguments)+" qazana-column qazana-"+(this.isInner()?"inner":"top")+"-column"},ui:function(){var e=r.prototype.ui.apply(this,arguments);return e.duplicateButton="> .qazana-element-overlay .qazana-editor-column-settings-list .qazana-editor-element-duplicate",e.removeButton="> .qazana-element-overlay .qazana-editor-column-settings-list .qazana-editor-element-remove",e.saveButton="> .qazana-element-overlay .qazana-editor-column-settings-list .qazana-editor-element-save",e.triggerButton="> .qazana-element-overlay .qazana-editor-column-settings-list .qazana-editor-element-trigger",e.addButton="> .qazana-element-overlay .qazana-editor-column-settings-list .qazana-editor-element-add",e.columnTitle=".column-title",e.columnInner="> .qazana-column-wrap",e.listTriggers="> .qazana-element-overlay .qazana-editor-element-trigger",e},triggers:{"click @ui.addButton":"click:new"},events:function(){var e=r.prototype.events.apply(this,arguments);return e["click @ui.listTriggers"]="onClickTrigger",e["click @ui.triggerButton"]="onClickEdit",e},initialize:function(){r.prototype.initialize.apply(this,arguments),this.listenTo(qazana.channels.data,"widget:drag:start",this.onWidgetDragStart),this.listenTo(qazana.channels.data,"widget:drag:end",this.onWidgetDragEnd)},isDroppingAllowed:function(){var e=qazana.channels.panelElements.request("element:selected").model.get("elType");return"section"===e?!this.isInner():"widget"===e},changeSizeUI:function(){var e=this.model.getSetting("_column_size"),t=this.model.getSetting("_inline_size"),i=parseFloat(t||e).toFixed(1)+"%";this.$el.attr("data-col",e),this.ui.columnTitle.html(i)},getSortableOptions:function(){return{connectWith:".qazana-widget-wrap",items:"> .qazana-element"}},onCollectionChanged:function(){r.prototype.onCollectionChanged.apply(this,arguments),this.changeChildContainerClasses()},changeChildContainerClasses:function(){this.collection.isEmpty()?this.ui.columnInner.removeClass("qazana-element-populated").addClass("qazana-element-empty"):this.ui.columnInner.removeClass("qazana-element-empty").addClass("qazana-element-populated")},onRender:function(){var e=this;e.changeChildContainerClasses(),e.changeSizeUI(),e.$el.html5Droppable({items:" > .qazana-column-wrap > .qazana-widget-wrap > .qazana-element, >.qazana-column-wrap > .qazana-widget-wrap > .qazana-empty-view > .qazana-first-add",axis:["vertical"],groups:["qazana-element"],isDroppingAllowed:_.bind(e.isDroppingAllowed,e),onDragEnter:function(){e.$el.addClass("qazana-dragging-on-child")},onDragging:function(e,t){t.stopPropagation(),this.dataset.side!==e&&Backbone.$(this).attr("data-side",e)},onDragLeave:function(){e.$el.removeClass("qazana-dragging-on-child"),Backbone.$(this).removeAttr("data-side")},onDropping:function(t,i){i.stopPropagation();var n=Backbone.$(this).index();"bottom"===t&&n++,e.addElementFromPanel({at:n})}})},onClickTrigger:function(e){e.preventDefault();var t=this.$(e.currentTarget),i=t.hasClass("qazana-active");this.ui.listTriggers.removeClass("qazana-active"),i||t.addClass("qazana-active")},onWidgetDragStart:function(){this.$el.addClass("qazana-dragging")},onWidgetDragEnd:function(){this.$el.removeClass("qazana-dragging")}}),t.exports=n},{"qazana-behaviors/duplicate":1,"qazana-behaviors/edit-tools-section":2,"qazana-behaviors/handle-duplicate":3,"qazana-behaviors/resizable":5,"qazana-behaviors/sortable":6,"qazana-views/base-element":77,"qazana-views/element-empty":106}],80:[function(e,t,i){var n;n=e("qazana-views/controls/base").extend({onReady:function(){this.ui.select.select2()}}),t.exports=n},{"qazana-views/controls/base":83}],81:[function(e,t,i){var n;n=e("qazana-views/controls/base").extend({applySavedValue:function(){var e=this.getControlValue(),t=this.$("[data-setting]"),i=this;_.each(e,function(e,n){var r=t.filter(function(){return n===this.dataset.setting});i.setInputValue(r,e)})},getControlValue:function(e){var t=this.elementSettingsModel.get(this.model.get("name"));return Backbone.$.isPlainObject(t)?e?t[e]||"":qazana.helpers.cloneObject(t):{}},setValue:function(e,t){var i=this.getControlValue();"object"==typeof e?_.each(e,function(e,t){i[t]=e}):i[e]=t,this.setSettingsModel(i)},updateElementModel:function(e){var t=this.getInputValue(e.currentTarget),i=e.currentTarget.dataset.setting;this.setValue(i,t)}},{getStyleValue:function(e,t){return _.isObject(t)?t[e]:""}}),t.exports=n},{"qazana-views/controls/base":83}],82:[function(e,t,i){var n;n=e("qazana-views/controls/base-multiple").extend({getCurrentRange:function(){return this.getUnitRange(this.getControlValue("unit"))},getUnitRange:function(e){var t=this.model.get("range");return!(!t||!t[e])&&t[e]}}),t.exports=n},{"qazana-views/controls/base-multiple":81}],83:[function(e,t,i){var n;n=Marionette.CompositeView.extend({ui:function(){return{input:'input[data-setting][type!="checkbox"][type!="radio"]',checkbox:'input[data-setting][type="checkbox"]',radio:'input[data-setting][type="radio"]',select:"select[data-setting]",textarea:"textarea[data-setting]",controlTitle:".qazana-control-title",responsiveSwitchers:".qazana-responsive-switcher",switcherDesktop:".qazana-responsive-switcher-desktop"}},className:function(){var e="qazana-control qazana-control-"+this.model.get("name")+" qazana-control-type-"+this.model.get("type"),t=this.model.get("classes"),i=this.model.get("responsive");return _.isEmpty(t)||(e+=" "+t),_.isEmpty(this.model.get("section"))||(e+=" qazana-control-under-section"),_.isEmpty(i)||(e+=" qazana-control-responsive-"+i),e},getTemplate:function(){return Marionette.TemplateCache.get("#tmpl-qazana-control-"+this.model.get("type")+"-content")},templateHelpers:function(){var e={controlValue:this.getControlValue(),_cid:this.model.cid};return{data:_.extend({},this.model.toJSON(),e)}},baseEvents:{"input @ui.input":"onBaseInputChange","change @ui.checkbox":"onBaseInputChange","change @ui.radio":"onBaseInputChange","input @ui.textarea":"onBaseInputChange","change @ui.select":"onBaseInputChange","click @ui.switcherDesktop":"onSwitcherDesktopClick","click @ui.responsiveSwitchers":"onSwitcherClick"},childEvents:{},events:function(){return _.extend({},this.baseEvents,this.childEvents)},initialize:function(e){this.elementSettingsModel=e.elementSettingsModel;var t=this.model.get("type"),i=Backbone.$.extend(!0,{},qazana.config.controls[t],this.model.attributes);this.model.set(i),this.listenTo(this.elementSettingsModel,"change",this.toggleControlVisibility),this.listenTo(this.elementSettingsModel,"control:switch:tab",this.onControlSwitchTab)},getControlValue:function(){return this.elementSettingsModel.get(this.model.get("name"))},isValidValue:function(e){return!0},setValue:function(e){this.setSettingsModel(e)},setSettingsModel:function(e){if(!0===this.isValidValue(e)){this.elementSettingsModel.set(this.model.get("name"),e),this.triggerMethod("settings:change");var t=this.elementSettingsModel.get("elType");"widget"===t&&(t=this.elementSettingsModel.get("widgetType")),void 0!==t&&qazana.hooks.doAction("panel/editor/element/"+t+"/"+this.model.get("name")+"/changed")}else this.triggerMethod("settings:error")},applySavedValue:function(){this.setInputValue('[data-setting="'+this.model.get("name")+'"]',this.getControlValue())},getEditSettings:function(e){var t=this.getOption("elementEditSettings").toJSON();return e?t[e]:t},setEditSetting:function(e,t){this.getOption("elementEditSettings").set(e,t)},getInputValue:function(e){var t=this.$(e),i=t.val(),n=t.attr("type");return-1!==["radio","checkbox"].indexOf(n)?t.prop("checked")?i:"":("SELECT"===e.tagName&&t.prop("multiple")&&null===i&&(i=[]),i)},setInputValue:function(e,t){var i=this.$(e),n=i.attr("type");"checkbox"===n?i.prop("checked",!!t):"radio"===n?i.filter('[value="'+t+'"]').prop("checked",!0):"select2"===n||i.val(t)},onSettingsError:function(){this.$el.addClass("qazana-error")},onSettingsChange:function(){this.$el.removeClass("qazana-error")},onRender:function(){this.applySavedValue();var e=this.model.get("label_block")?"block":"inline",t=this.model.get("show_label"),i="qazana-label-"+e;i+=" qazana-control-separator-"+this.model.get("separator"),t||(i+=" qazana-control-hidden-label"),this.$el.addClass(i),this.renderResponsiveSwitchers(),this.triggerMethod("ready"),this.toggleControlVisibility()},onBaseInputChange:function(e){this.updateElementModel(e),this.triggerMethod("input:change",e)},onSwitcherClick:function(e){var t=Backbone.$(e.currentTarget).data("device");qazana.changeDeviceMode(t)},onSwitcherDesktopClick:function(){qazana.getPanelView().getCurrentPageView().$el.toggleClass("qazana-responsive-switchers-open")},renderResponsiveSwitchers:function(){if(!_.isEmpty(this.model.get("responsive"))){var e=Backbone.$("#tmpl-qazana-control-responsive-switchers").html();this.ui.controlTitle.after(e)}},toggleControlVisibility:function(){var e=qazana.helpers.isActiveControl(this.model,this.elementSettingsModel.attributes);this.$el.toggleClass("qazana-hidden-control",!e),qazana.channels.data.trigger("scrollbar:update")},onControlSwitchTab:function(e){this.$el.toggleClass("qazana-active-tab",e===this.model.get("tab")),qazana.channels.data.trigger("scrollbar:update")},onReady:function(){},updateElementModel:function(e){this.setValue(this.getInputValue(e.currentTarget))}},{getStyleValue:function(e,t){return t}}),t.exports=n},{}],84:[function(e,t,i){var n,r=e("qazana-views/controls/base-multiple");n=r.extend({ui:function(){var e=r.prototype.ui.apply(this,arguments);return e.sliders=".qazana-slider",e.colors=".qazana-box-shadow-color-picker",e},childEvents:{"slide @ui.sliders":"onSlideChange"},initSliders:function(){var e=this.getControlValue();this.ui.sliders.each(function(){var t=Backbone.$(this),i=t.next(".qazana-slider-input").find("input");t.slider({value:e[this.dataset.input],min:+i.attr("min"),max:+i.attr("max")})})},initColors:function(){var e=this;qazana.helpers.wpColorPicker(this.ui.colors,{change:function(){var t=Backbone.$(this),i=t.data("setting");e.setValue(i,t.wpColorPicker("color"))},clear:function(){e.setValue(this.dataset.setting,"")}})},onInputChange:function(e){var t=e.currentTarget.dataset.setting;this.ui.sliders.filter('[data-input="'+t+'"]').slider("value",this.getControlValue(t))},onReady:function(){this.initSliders(),this.initColors()},onSlideChange:function(e,t){var i=e.currentTarget.dataset.input;this.ui.input.filter('[data-setting="'+i+'"]').val(t.value),this.setValue(i,t.value)},onBeforeDestroy:function(){this.ui.colors.each(function(){var e=Backbone.$(this);e.wpColorPicker("instance")&&e.wpColorPicker("close")}),this.$el.remove()}}),t.exports=n},{"qazana-views/controls/base-multiple":81}],85:[function(e,t,i){var n,r=e("qazana-views/controls/base");n=r.extend({ui:function(){var e=r.prototype.ui.apply(this,arguments);return e.inputs='[type="radio"]',e},childEvents:{"mousedown label":"onMouseDownLabel","click @ui.inputs":"onClickInput","change @ui.inputs":"updateElementModel"},onMouseDownLabel:function(e){var t=this.$(e.currentTarget),i=this.$("#"+t.attr("for"));i.data("checked",i.prop("checked"))},onClickInput:function(e){if(this.model.get("toggle")){var t=this.$(e.currentTarget);t.data("checked")&&t.prop("checked",!1).trigger("change")}},onRender:function(){r.prototype.onRender.apply(this,arguments);var e=this.getControlValue();e?this.ui.inputs.filter('[value="'+e+'"]').prop("checked",!0):this.model.get("toggle")||this.ui.inputs.first().prop("checked",!0).trigger("change")}}),t.exports=n},{"qazana-views/controls/base":83}],86:[function(e,t,i){var n,r=e("qazana-views/controls/base");n=r.extend({ui:function(){var e=r.prototype.ui.apply(this,arguments);return e.editor=".qazana-code-editor",e},onReady:function(){var e=this;if("undefined"!=typeof ace&&(e.editor=ace.edit(this.ui.editor[0]),Backbone.$(e.editor.container).addClass("qazana-input-style qazana-code-editor"),e.editor.setOptions({mode:"ace/mode/"+e.model.attributes.language,minLines:10,maxLines:1/0,showGutter:!0,useWorker:!0}),e.editor.setValue(e.getControlValue(),-1),e.editor.on("change",function(){e.setValue(e.editor.getValue())}),"html"===e.model.attributes.language)){var t=e.editor.getSession();t.on("changeAnnotation",function(){for(var e=t.getAnnotations()||[],i=e.length,n=e.length;n--;)/doctype first\. Expected/.test(e[n].text)&&e.splice(n,1);i>e.length&&t.setAnnotations(e)})}}}),t.exports=n},{"qazana-views/controls/base":83}],87:[function(e,t,i){var n,r=e("qazana-views/controls/base");n=r.extend({ui:function(){var e=r.prototype.ui.apply(this,arguments);return e.picker=".color-picker-hex",e},onReady:function(){qazana.helpers.wpColorPicker(this.ui.picker,{change:_.bind(function(){this.setValue(this.ui.picker.wpColorPicker("color"))},this),clear:_.bind(function(){this.setValue("")},this)}).wpColorPicker("instance").wrap.find("> .wp-picker-input-wrap > .wp-color-picker").removeAttr("maxlength")},onBeforeDestroy:function(){this.ui.picker.wpColorPicker("instance")&&this.ui.picker.wpColorPicker("close"),this.$el.remove()}}),t.exports=n},{"qazana-views/controls/base":83}],88:[function(e,t,i){var n,r=e("qazana-views/controls/base");n=r.extend({ui:function(){var e=r.prototype.ui.apply(this,arguments);return e.picker=".qazana-date-time-picker",e},onReady:function(){var e=this,t=_.extend(this.model.get("picker_options"),{onHide:function(){e.saveValue()}});this.ui.picker.appendDtpicker(t).handleDtpicker("setDate",new Date(this.getControlValue()))},saveValue:function(){this.setValue(this.ui.input.val())},onBeforeDestroy:function(){this.saveValue(),this.ui.picker.dtpicker("destroy")}}),t.exports=n},{"qazana-views/controls/base":83}],89:[function(e,t,i){var n,r=e("qazana-views/controls/base-units");n=r.extend({ui:function(){var e=r.prototype.ui.apply(this,arguments);return e.controls=".qazana-control-dimension > input:enabled",e.link="button.qazana-link-dimensions",e},childEvents:{"click @ui.link":"onLinkDimensionsClicked"},defaultDimensionValue:0,initialize:function(){r.prototype.initialize.apply(this,arguments),this.model.set("allowed_dimensions",this.filterDimensions(this.model.get("allowed_dimensions")))},getPossibleDimensions:function(){return["top","right","bottom","left"]},filterDimensions:function(e){e=e||"all";var t=this.getPossibleDimensions();return"all"===e?t:(_.isArray(e)||("horizontal"===e?e=["right","left"]:"vertical"===e&&(e=["top","bottom"])),e)},onReady:function(){var e=this.getControlValue();this.isLinkedDimensions()||(this.ui.link.addClass("unlinked"),this.ui.controls.each(_.bind(function(t,i){var n=e[i.dataset.setting];_.isEmpty(n)&&(n=this.defaultDimensionValue),this.$(i).val(n)},this))),this.fillEmptyDimensions()},updateDimensionsValue:function(){var e={},t=this.getPossibleDimensions(),i=this.ui.controls;t.forEach(_.bind(function(t){var n=i.filter('[data-setting="'+t+'"]');e[t]=n.length?n.val():this.defaultDimensionValue},this)),this.setValue(e)},fillEmptyDimensions:function(){var e=this.getPossibleDimensions(),t=this.model.get("allowed_dimensions"),i=this.ui.controls;this.isLinkedDimensions()||e.forEach(_.bind(function(e){var n=i.filter('[data-setting="'+e+'"]');-1!==_.indexOf(t,e)&&n.length&&_.isEmpty(n.val())&&n.val(this.defaultDimensionValue)},this))},updateDimensions:function(){this.fillEmptyDimensions(),this.updateDimensionsValue()},resetDimensions:function(){this.ui.controls.val(""),this.updateDimensionsValue()},onInputChange:function(e){var t=e.target.dataset.setting;if("unit"===t&&this.resetDimensions(),_.contains(this.getPossibleDimensions(),t)){if(this.isLinkedDimensions()){var i=this.$(e.target);this.ui.controls.val(i.val())}this.updateDimensions()}},onLinkDimensionsClicked:function(e){e.preventDefault(),e.stopPropagation(),this.ui.link.toggleClass("unlinked"),this.setValue("isLinked",!this.ui.link.hasClass("unlinked")),this.isLinkedDimensions()&&this.ui.controls.val(this.ui.controls.eq(0).val()),this.updateDimensions()},isLinkedDimensions:function(){return this.getControlValue("isLinked")}}),t.exports=n},{"qazana-views/controls/base-units":82}],90:[function(e,t,i){var n,r=e("qazana-views/controls/base");n=r.extend({onReady:function(){this.ui.select.select2({dir:qazana.config.is_rtl?"rtl":"ltr"})},templateHelpers:function(){var e=r.prototype.templateHelpers.apply(this,arguments);return e.getFontsByGroups=_.bind(function(e){var t=this.model.get("fonts"),i={};return _.each(t,function(t,n){(_.isArray(e)&&_.contains(e,t)||t===e)&&(i[n]=t)}),i},this),e}}),t.exports=n},{"qazana-views/controls/base":83}],91:[function(e,t,i){var n,r=e("qazana-views/controls/base");n=r.extend({ui:function(){var e=r.prototype.ui.apply(this,arguments);return e.addImages=".qazana-control-gallery-add",e.clearGallery=".qazana-control-gallery-clear",e.galleryThumbnails=".qazana-control-gallery-thumbnails",e},childEvents:{"click @ui.addImages":"onAddImagesClick","click @ui.clearGallery":"onClearGalleryClick","click @ui.galleryThumbnails":"onGalleryThumbnailsClick"},onReady:function(){var e=this.hasImages();this.$el.toggleClass("qazana-gallery-has-images",e).toggleClass("qazana-gallery-empty",!e),this.initRemoveDialog()},hasImages:function(){return!!this.getControlValue().length},openFrame:function(e){this.initFrame(e),this.frame.open()},initFrame:function(e){var t={frame:"post",multiple:!0,state:{create:"gallery",add:"gallery-library",edit:"gallery-edit"}[e],button:{text:qazana.translate("insert_media")}};this.hasImages()&&(t.selection=this.fetchSelection()),this.frame=wp.media(t),this.frame.on({update:this.select,"menu:render:default":this.menuRender,"content:render:browse":this.gallerySettings},this)},menuRender:function(e){e.unset("insert"),e.unset("featured-image")},gallerySettings:function(e){e.sidebar.on("ready",function(){e.sidebar.unset("gallery")})},fetchSelection:function(){var e=wp.media.query({orderby:"post__in",order:"ASC",type:"image",perPage:-1,post__in:_.pluck(this.getControlValue(),"id")});return new wp.media.model.Selection(e.models,{props:e.props.toJSON(),multiple:!0})},select:function(e){var t=[];e.each(function(e){t.push({id:e.get("id"),url:e.get("url")})}),this.setValue(t),this.render()},onBeforeDestroy:function(){this.frame&&this.frame.off(),this.$el.remove()},resetGallery:function(){this.setValue(""),this.render()},initRemoveDialog:function(){var e;this.getRemoveDialog=function(){return e||(e=qazana.dialogsManager.createWidget("confirm",{message:qazana.translate("dialog_confirm_gallery_delete"),headerMessage:qazana.translate("delete_gallery"),strings:{confirm:qazana.translate("delete"),cancel:qazana.translate("cancel")},defaultOption:"confirm",onConfirm:_.bind(this.resetGallery,this)})),e}},onAddImagesClick:function(){this.openFrame(this.hasImages()?"add":"create")},onClearGalleryClick:function(){this.getRemoveDialog().show()},onGalleryThumbnailsClick:function(){this.openFrame("edit")}}),t.exports=n},{"qazana-views/controls/base":83}],92:[function(e,t,i){var n,r=e("qazana-views/controls/base");n=r.extend({initialize:function(){r.prototype.initialize.apply(this,arguments),this.filterIcons()},filterIcons:function(){var e=this.model.get("icons"),t=this.model.get("include"),i=this.model.get("exclude");if(t){var n={};return _.each(t,function(t){n[t]=e[t]}),void this.model.set("icons",n)}i&&_.each(i,function(t){delete e[t]})},iconsList:function(e){return e.id?Backbone.$('<span><i class="'+e.id+'"></i> '+e.text+"</span>"):e.text},onReady:function(){this.ui.select.fontIconPicker({theme:"fip-grey"})},templateHelpers:function(){var e=r.prototype.templateHelpers.apply(this,arguments);return e.getIconsByGroups=_.bind(function(e){var t=this.model.get("icons"),i={};return _.each(t,function(t,n){(_.isArray(e)&&_.contains(e,t)||t===e)&&(i[n]=t)}),i},this),e}}),t.exports=n},{"qazana-views/controls/base":83}],93:[function(e,t,i){var n;n=e("qazana-views/controls/base-multiple").extend({ui:function(){return{inputWidth:'input[data-setting="width"]',inputHeight:'input[data-setting="height"]',btnApply:"button.qazana-image-dimensions-apply-button"}},baseEvents:{"click @ui.btnApply":"onApplyClicked"},onApplyClicked:function(e){e.preventDefault(),this.setValue({width:this.ui.inputWidth.val(),height:this.ui.inputHeight.val()})}}),t.exports=n},{"qazana-views/controls/base-multiple":81}],94:[function(e,t,i){var n,r=e("qazana-views/controls/base-multiple");n=r.extend({ui:function(){var e=r.prototype.ui.apply(this,arguments);return e.controlMedia=".qazana-control-media",e.frameOpeners=".qazana-control-media-upload-button, .qazana-control-media-image",e.deleteButton=".qazana-control-media-delete",e},childEvents:{"click @ui.frameOpeners":"openFrame","click @ui.deleteButton":"deleteImage"},onReady:function(){_.isEmpty(this.getControlValue("url"))&&this.ui.controlMedia.addClass("media-empty")},openFrame:function(){this.frame||this.initFrame(),this.frame.open()},deleteImage:function(){this.setValue({url:"",id:""}),this.render()},initFrame:function(){this.frame=wp.media({button:{text:qazana.translate("insert_media")},states:[new wp.media.controller.Library({title:qazana.translate("insert_media"),library:wp.media.query({type:"image"}),multiple:!1,date:!1})]}),this.frame.on("insert select",_.bind(this.select,this))},select:function(){var e=this.frame.state().get("selection").first().toJSON();e.url&&(this.setValue({url:e.url,id:e.id}),this.render())},onBeforeDestroy:function(){this.$el.remove()}}),t.exports=n},{"qazana-views/controls/base-multiple":81}],95:[function(e,t,i){var n,r=e("qazana-views/controls/base-multiple");n=r.extend({ui:function(){var e=r.prototype.ui.apply(this,arguments);return e.reverseOrderLabel=".qazana-control-order-label",e},changeLabelTitle:function(){var e=this.getControlValue("reverse_order");this.ui.reverseOrderLabel.attr("title",qazana.translate(e?"asc":"desc"))},onRender:function(){r.prototype.onRender.apply(this,arguments),this.changeLabelTitle()},onInputChange:function(){this.changeLabelTitle()}}),t.exports=n},{"qazana-views/controls/base-multiple":81}],96:[function(e,t,i){var n;n=Marionette.CompositeView.extend({template:Marionette.TemplateCache.get("#tmpl-qazana-repeater-row"),className:"repeater-fields",ui:{duplicateButton:".qazana-repeater-tool-duplicate",editButton:".qazana-repeater-tool-edit",removeButton:".qazana-repeater-tool-remove",itemTitle:".qazana-repeater-row-item-title"},behaviors:{HandleInnerTabs:{behaviorClass:e("qazana-behaviors/inner-tabs")}},triggers:{"click @ui.removeButton":"click:remove","click @ui.duplicateButton":"click:duplicate","click @ui.itemTitle":"click:edit"},templateHelpers:function(){return{itemIndex:this.getOption("itemIndex")}},childViewContainer:".qazana-repeater-row-controls",getChildView:function(e){var t=e.get("type");return qazana.getControlItemView(t)},childViewOptions:function(){return{elementSettingsModel:this.model}},checkConditions:function(){var e=this;e.collection.each(function(t){var i=t.get("conditions"),n=t.get("parent_conditions"),r=!0;i&&(r=qazana.conditions.check(i,e.model.attributes)),n&&(r=qazana.conditions.check(n,e.getOption("parentModel").attributes)),e.children.findByModelCid(t.cid).$el.toggleClass("qazana-panel-hide",!r)})},updateIndex:function(e){this.itemIndex=e,this.setTitle()},setTitle:function(){var e=this,t=e.getOption("titleField"),i="";if(t){var n={};e.children.each(function(e){n[e.model.get("name")]=e.getControlValue()}),i=Marionette.TemplateCache.prototype.compileTemplate(t)(n)}i||(i=qazana.translate("Item #{0}",[e.getOption("itemIndex")])),e.ui.itemTitle.html(i)},initialize:function(e){var t=this;t.elementSettingsModel=e.elementSettingsModel,t.itemIndex=0,t.collection=new Backbone.Collection(e.controlFields),t.listenTo(t.model,"change",t.checkConditions),t.listenTo(t.getOption("parentModel"),"change",t.checkConditions),e.titleField&&t.listenTo(t.model,"change",t.setTitle)},onRender:function(){this.setTitle(),this.checkConditions()}}),t.exports=n},{"qazana-behaviors/inner-tabs":4}],97:[function(e,t,i){var n,r=e("qazana-views/controls/base"),o=e("qazana-views/controls/repeater-row");n=r.extend({ui:{btnAddRow:".qazana-repeater-add",fieldContainer:".qazana-repeater-fields"},events:{"click @ui.btnAddRow":"onButtonAddRowClick","sortstart @ui.fieldContainer":"onSortStart","sortupdate @ui.fieldContainer":"onSortUpdate","sortstop @ui.fieldContainer":"onSortStop"},childView:o,childViewContainer:".qazana-repeater-fields",templateHelpers:function(){return{data:_.extend({},this.model.toJSON(),{controlValue:[]})}},childViewOptions:function(){return{controlFields:this.model.get("fields"),titleField:this.model.get("title_field"),parentModel:this.elementSettingsModel}},initialize:function(e){r.prototype.initialize.apply(this,arguments),this.collection=this.elementSettingsModel.get(this.model.get("name")),this.collection.each(function(e){e.get("_id")||e.set("_id",qazana.helpers.getUniqueID())}),this.listenTo(this.collection,"change add remove reset",this.onCollectionChanged,this)},addRow:function(e,t){var i=qazana.helpers.getUniqueID();return e instanceof Backbone.Model?e.set("_id",i):e._id=i,this.collection.add(e,t)},editRow:function(e){if(this.currentEditableChild){var t=this.currentEditableChild.getChildViewContainer(this.currentEditableChild);t.removeClass("editable"),t.find(".qazana-wp-editor").each(function(){tinymce.get(this.id).fire("hide")})}this.currentEditableChild!==e?(e.getChildViewContainer(e).addClass("editable"),this.currentEditableChild=e,this.updateActiveRow()):delete this.currentEditableChild},toggleMinRowsClass:function(){this.model.get("prevent_empty")&&this.$el.toggleClass("qazana-repeater-has-minimum-rows",1>=this.collection.length)},updateActiveRow:function(){var e=0;this.currentEditableChild&&(e=this.currentEditableChild.itemIndex),this.setEditSetting("activeItemIndex",e)},updateChildIndexes:function(){this.children.each(_.bind(function(e){e.updateIndex(this.collection.indexOf(e.model)+1)},this))},onRender:function(){r.prototype.onRender.apply(this,arguments),this.ui.fieldContainer.sortable({axis:"y",handle:".qazana-repeater-row-tools"}),this.toggleMinRowsClass()},onSortStart:function(e,t){t.item.data("oldIndex",t.item.index())},onSortStop:function(e,t){t.item.find(".qazana-wp-editor").each(function(){var e=tinymce.get(this.id),t=e.settings;t.height=Backbone.$(e.getContainer()).height(),tinymce.execCommand("mceRemoveEditor",!0,this.id),tinymce.init(t)})},onSortUpdate:function(e,t){var i=t.item.data("oldIndex"),n=this.collection.at(i),r=t.item.index();this.collection.remove(n),this.addRow(n,{at:r})},onAddChild:function(){this.updateChildIndexes(),this.updateActiveRow()},onRemoveChild:function(e){e===this.currentEditableChild&&delete this.currentEditableChild,this.updateChildIndexes(),this.updateActiveRow()},onCollectionChanged:function(){this.elementSettingsModel.trigger("change"),this.toggleMinRowsClass()},onButtonAddRowClick:function(){var e={};_.each(this.model.get("fields"),function(t){e[t.name]=t.default});var t=this.addRow(e),i=this.children.findByModel(t);this.editRow(i)},onChildviewClickRemove:function(e){e.model.destroy()},onChildviewClickDuplicate:function(e){this.addRow(e.model.clone(),{at:e.itemIndex})},onChildviewClickEdit:function(e){this.editRow(e)}}),t.exports=n},{"qazana-views/controls/base":83,"qazana-views/controls/repeater-row":96}],98:[function(e,t,i){var n,r=e("qazana-views/controls/base");n=r.extend({ui:function(){var e=r.prototype.ui.apply(this,arguments);return e.heading=".qazana-panel-heading",e},triggers:{click:"control:section:clicked"}}),t.exports=n},{"qazana-views/controls/base":83}],99:[function(e,t,i){var n,r=e("qazana-views/controls/base");n=r.extend({ui:function(){var e=r.prototype.ui.apply(this,arguments);return e.select=".qazana-select2",e},onReady:function(){var e={allowClear:!0,placeholder:{id:""}};this.ui.select.select2(e)},onBeforeDestroy:function(){this.ui.select.data("select2")&&this.ui.select.select2("destroy"),this.$el.remove()}}),t.exports=n},{"qazana-views/controls/base":83}],100:[function(e,t,i){var n,r=e("qazana-views/controls/base-units");n=r.extend({ui:function(){var e=r.prototype.ui.apply(this,arguments);return e.slider=".qazana-slider",e},childEvents:{"slide @ui.slider":"onSlideChange"},initSlider:function(){var e=this.getControlValue("size"),t=this.getCurrentRange();e&&t&&this.ui.input.attr(t).val(e),this.ui.slider&&this.ui.slider.slider(_.extend({},t,{value:e}))},resetSize:function(){this.setValue("size",""),this.initSlider()},onReady:function(){this.initSlider()},onSlideChange:function(e,t){this.setValue("size",t.value),this.ui.input.val(t.value)},onInputChange:function(e){var t=e.currentTarget.dataset.setting;"size"===t?this.ui.slider.slider("value",this.getControlValue("size")):"unit"===t&&this.resetSize()},onBeforeDestroy:function(){this.ui.slider&&this.ui.slider.slider("destroy"),this.$el.remove()}}),t.exports=n},{"qazana-views/controls/base-units":82}],101:[function(e,t,i){var n,r=e("qazana-views/controls/base");n=r.extend({ui:function(){var e=r.prototype.ui.apply(this,arguments);return e.resetStructure=".qazana-control-structure-reset",e},childEvents:{"click @ui.resetStructure":"onResetStructureClick"},templateHelpers:function(){var e=r.prototype.templateHelpers.apply(this,arguments);return e.getMorePresets=_.bind(this.getMorePresets,this),e},getCurrentEditedSection:function(){return qazana.getPanelView().getCurrentPageView().getOption("editedElementView")},getMorePresets:function(){var e=qazana.presetsFactory.getParsedStructure(this.getControlValue());return qazana.presetsFactory.getPresets(e.columnsCount)},onInputChange:function(){this.getCurrentEditedSection().redefineLayout(),this.render()},onResetStructureClick:function(){this.getCurrentEditedSection().resetColumnsCustomSize()}}),t.exports=n},{"qazana-views/controls/base":83}],102:[function(e,t,i){var n;n=e("qazana-views/controls/base").extend({triggers:{click:"control:tab:clicked"}}),t.exports=n},{"qazana-views/controls/base":83}],103:[function(e,t,i){var n,r=e("qazana-views/controls/base-multiple");n=r.extend({ui:function(){var e=r.prototype.ui.apply(this,arguments);return e.btnExternal="button.qazana-control-url-target",e},childEvents:{"click @ui.btnExternal":"onExternalClicked"},onReady:function(){this.getControlValue("is_external")&&this.ui.btnExternal.addClass("active")},onExternalClicked:function(e){e.preventDefault(),this.ui.btnExternal.toggleClass("active"),this.setValue("is_external",this.isExternal())},isExternal:function(){return this.ui.btnExternal.hasClass("active")}}),t.exports=n},{"qazana-views/controls/base-multiple":81}],104:[function(e,t,i){var n,r=e("qazana-views/controls/base");n=r.extend({ui:function(){var e=r.prototype.ui.apply(this,arguments);return e.form="form",e.loading=".wp-widget-form-loading",e},events:{"keyup @ui.form :input":"onFormChanged","change @ui.form :input":"onFormChanged"},onFormChanged:function(){var e="widget-"+this.model.get("id_base"),t=this.ui.form.qazanaSerializeObject()[e].REPLACE_TO_ID;this.setValue(t)},onReady:function(){qazana.ajax.send("editor_get_wp_widget_form",{data:{widget_type:this.model.get("widget"),data:JSON.stringify(this.elementSettingsModel.toJSON())},success:_.bind(function(e){this.ui.form.html(e)},this)})}}),t.exports=n},{"qazana-views/controls/base":83}],105:[function(e,t,i){var n,r=e("qazana-views/controls/base");n=r.extend({childEvents:{"keyup textarea.qazana-wp-editor":"updateElementModel"},buttons:{moveToAdvanced:{blockquote:"removeformat",alignleft:"blockquote",aligncenter:"alignleft",alignright:"aligncenter"},moveToBasic:{},removeFromBasic:["unlink","wp_more"],removeFromAdvanced:[]},initialize:function(){r.prototype.initialize.apply(this,arguments);var e=this;if(e.editorID="qazanawpeditor"+e.cid,_.defer(function(){quicktags({buttons:"strong,em,del,link,img,close",id:e.editorID}),qazana.config.rich_editing_enabled&&switchEditors.go(e.editorID,"tmce"),delete QTags.instances[0]}),qazana.config.rich_editing_enabled){var t={id:e.editorID,selector:"#"+e.editorID,setup:function(t){t.on("keyup change undo redo SetContent",function(){t.save(),e.setValue(t.getContent())})}};tinyMCEPreInit.mceInit[e.editorID]=_.extend(_.clone(tinyMCEPreInit.mceInit.qazanawpeditor),t),e.rearrangeButtons()}else e.$el.addClass("qazana-rich-editing-disabled")},attachElContent:function(){var e=qazana.config.wp_editor.replace(/qazanawpeditor/g,this.editorID).replace("%%EDITORCONTENT%%",this.getControlValue());return this.$el.html(e),this},moveButtons:function(e,t,i){_.each(e,function(e,n){var r=t.indexOf(n),o=i.indexOf(e);if(-1===r)throw new ReferenceError("Trying to move non-existing button `"+n+"`");if(-1===o)throw new ReferenceError("Trying to move button after non-existing button `"+e+"`");t.splice(r,1),i.splice(o+1,0,n)})},rearrangeButtons:function(){var e=tinyMCEPreInit.mceInit[this.editorID],t=e.toolbar1.split(","),i=e.toolbar2.split(",");t=_.difference(t,this.buttons.removeFromBasic),i=_.difference(i,this.buttons.removeFromAdvanced),this.moveButtons(this.buttons.moveToBasic,i,t),this.moveButtons(this.buttons.moveToAdvanced,t,i),e.toolbar1=t.join(","),e.toolbar2=i.join(",")},onBeforeDestroy:function(){delete QTags.instances[this.editorID],qazana.config.rich_editing_enabled&&(tinymce.EditorManager.execCommand("mceRemoveEditor",!0,this.editorID),delete tinyMCEPreInit.mceInit[this.editorID],delete tinyMCEPreInit.qtInit[this.editorID])}}),t.exports=n},{"qazana-views/controls/base":83}],106:[function(e,t,i){var n;n=Marionette.ItemView.extend({template:"#tmpl-qazana-empty-preview",className:"qazana-empty-view",events:{click:"onClickAdd"},onClickAdd:function(){qazana.getPanelView().setPage("elements")}}),t.exports=n},{}],107:[function(e,t,i){var n;n=e("qazana-views/base-sections-container").extend({template:Marionette.TemplateCache.get("#tmpl-qazana-preview"),className:"qazana-inner",childViewContainer:".qazana-section-wrap",ui:{addSectionArea:"#qazana-add-section",addNewSection:"#qazana-add-new-section",closePresetsIcon:"#qazana-select-preset-close",addSectionButton:"#qazana-add-section-button",addTemplateButton:"#qazana-add-template-button",selectPreset:"#qazana-select-preset",presets:".qazana-preset"},events:{"click @ui.addSectionButton":"onAddSectionButtonClick","click @ui.addTemplateButton":"onAddTemplateButtonClick","click @ui.closePresetsIcon":"closeSelectPresets","click @ui.presets":"onPresetSelected"},closeSelectPresets:function(){this.ui.addNewSection.show(),this.ui.selectPreset.hide()},fixBlankPageOffset:function(){var e=27-this.$el.offset().top;if(0<e){var t=Backbone.$("<style>").text(".qazana-editor-active .qazana-inner{margin-top: "+e+"px}");qazana.$previewContents.children().children("head").append(t)}},onAddSectionButtonClick:function(){this.ui.addNewSection.hide(),this.ui.selectPreset.show()},onAddTemplateButtonClick:function(){qazana.templates.startModal(function(){qazana.templates.showTemplates()})},onRender:function(){var e=this;e.ui.addSectionArea.html5Droppable({axis:["vertical"],groups:["qazana-element"],onDragEnter:function(t){e.ui.addSectionArea.attr("data-side",t)},onDragLeave:function(){e.ui.addSectionArea.removeAttr("data-side")},onDropping:function(){e.addSection().addElementFromPanel()}}),_.defer(_.bind(e.fixBlankPageOffset,this))},onPresetSelected:function(e){this.closeSelectPresets();var t,i=e.currentTarget.dataset.structure,n=qazana.presetsFactory.getParsedStructure(i),r=[];for(t=0;t<n.columnsCount;t++)r.push({id:qazana.helpers.getUniqueID(),elType:"column",settings:{},elements:[]});var o=this.addSection({elements:r});o.setStructure(i),o.redefineLayout()}}),t.exports=n},{"qazana-views/base-sections-container":78}],108:[function(e,t,i){var n,r=e("qazana-views/base-element");n=r.extend({template:Marionette.TemplateCache.get("#tmpl-qazana-element-section-content"),className:function(){return r.prototype.className.apply(this,arguments)+" qazana-section qazana-"+(this.isInner()?"inner":"top")+"-section"},tagName:"section",childViewContainer:"> .qazana-container > .qazana-row",behaviors:{Sortable:{behaviorClass:e("qazana-behaviors/sortable"),elChildType:"column"},HandleDuplicate:{behaviorClass:e("qazana-behaviors/handle-duplicate")},HandleAddMode:{behaviorClass:e("qazana-behaviors/duplicate")}},ui:function(){var e=r.prototype.ui.apply(this,arguments);return e.duplicateButton=".qazana-editor-section-settings-list .qazana-editor-element-duplicate",e.removeButton=".qazana-editor-section-settings-list .qazana-editor-element-remove",e.saveButton=".qazana-editor-section-settings-list .qazana-editor-element-save",e.triggerButton=".qazana-editor-section-settings-list .qazana-editor-element-trigger",e},events:function(){var e=r.prototype.events.apply(this,arguments);return e["click @ui.triggerButton"]="onClickEdit",e},initialize:function(){r.prototype.initialize.apply(this,arguments),this.listenTo(this.collection,"add remove reset",this._checkIsFull).listenTo(this.collection,"remove",this.onCollectionRemove).listenTo(this.model,"change:settings:structure",this.onStructureChanged)},addEmptyColumn:function(){this.addChildModel({id:qazana.helpers.getUniqueID(),elType:"column",settings:{},elements:[]})},addChildModel:function(e,t){var i=e instanceof Backbone.Model,n=this.isInner();return i?e.set("isInner",n):e.isInner=n,r.prototype.addChildModel.apply(this,arguments)},getSortableOptions:function(){return{connectWith:(this.isInner()?".qazana-inner-section":".qazana-top-section")+" > .qazana-container > .qazana-row",handle:"> .qazana-element-overlay .qazana-editor-column-settings-list .qazana-editor-element-trigger",items:"> .qazana-column"}},getColumnPercentSize:function(e,t){return t/e.parent().width()*100},getDefaultStructure:function(){return this.collection.length+"0"},getStructure:function(){return this.model.getSetting("structure")},setStructure:function(e){if(+qazana.presetsFactory.getParsedStructure(e).columnsCount!==this.collection.length)throw new TypeError("The provided structure doesn't match the columns count.");this.model.setSetting("structure",e,!0)},redefineLayout:function(){var e=qazana.presetsFactory.getPresetByStructure(this.getStructure());this.collection.each(function(t,i){t.setSetting("_column_size",e.preset[i]),t.setSetting("_inline_size",null)}),this.children.invoke("changeSizeUI")},resetLayout:function(){this.setStructure(this.getDefaultStructure())},resetColumnsCustomSize:function(){this.collection.each(function(e){e.setSetting("_inline_size",null)}),this.children.invoke("changeSizeUI")},isCollectionFilled:function(){return 10<=this.collection.length},_checkIsFull:function(){this.$el.toggleClass("qazana-section-filled",this.isCollectionFilled())},_checkIsEmpty:function(){this.collection.length||this.addEmptyColumn()},getNextColumn:function(e){var t=this.collection.indexOf(e.model),i=this.collection.at(t+1);return this.children.findByModelCid(i.cid)},onBeforeRender:function(){this._checkIsEmpty()},onRender:function(){this._checkIsFull()},onAddChild:function(){this.isBuffering||this.resetLayout()},onCollectionRemove:function(){this._checkIsEmpty(),this.resetLayout()},onChildviewRequestResizeStart:function(e){var t=this.getNextColumn(e);if(t){var i=e.$el.find("iframe").add(t.$el.find("iframe"));qazana.helpers.disableElementEvents(i)}},onChildviewRequestResizeStop:function(e){var t=this.getNextColumn(e);if(t){var i=e.$el.find("iframe").add(t.$el.find("iframe"));qazana.helpers.enableElementEvents(i)}},onChildviewRequestResize:function(e,t){var i=e.model.getSetting("_inline_size");i||(i=this.getColumnPercentSize(t.element,t.originalSize.width));var n=this.getColumnPercentSize(t.element,t.size.width),r=n-i;t.element.css({width:"",left:"initial"});var o=this.getNextColumn(e);if(o){var l=o.$el,s=this.getColumnPercentSize(l,l.width())-r;n<10||n>100||!r||s<10||s>100||(e.model.setSetting("_inline_size",n.toFixed(3)),e.changeSizeUI(),o.model.setSetting("_inline_size",s.toFixed(3)),o.changeSizeUI())}},onStructureChanged:function(){this.redefineLayout()}}),t.exports=n},{"qazana-behaviors/duplicate":1,"qazana-behaviors/handle-duplicate":3,"qazana-behaviors/sortable":6,"qazana-views/base-element":77}],109:[function(e,t,i){var n,r=e("qazana-views/base-element");n=r.extend({_templateType:null,getTemplate:function(){var e=this.getEditModel();return"remote"!==this.getTemplateType()?Marionette.TemplateCache.get("#tmpl-qazana-"+e.get("elType")+"-"+e.get("widgetType")+"-content"):_.template("")},className:function(){return r.prototype.className.apply(this,arguments)+" qazana-widget"},events:function(){var e=r.prototype.events.apply(this,arguments);return e.click="onClickEdit",e},initialize:function(){r.prototype.initialize.apply(this,arguments);var e=this.getEditModel();"remote"!==this.getTemplateType()||this.getEditModel().getHtmlCache()||e.renderRemoteServer(),e.on({"before:remote:render":_.bind(this.onModelBeforeRemoteRender,this),"remote:render":_.bind(this.onModelRemoteRender,this)})},getTemplateType:function(){if(null===this._templateType){var e=this.getEditModel(),t=Backbone.$("#tmpl-qazana-"+e.get("elType")+"-"+e.get("widgetType")+"-content");this._templateType=t.length?"js":"remote"}return this._templateType},onModelBeforeRemoteRender:function(){this.$el.addClass("qazana-loading")},onBeforeDestroy:function(){qazana.$previewContents.find("#qazana-style-"+this.model.cid).remove()},onModelRemoteRender:function(){this.isDestroyed||(this.$el.removeClass("qazana-loading"),this.render())},getHTMLContent:function(e){return this.getEditModel().getHtmlCache()||e},attachElContent:function(e){var t=this.getHTMLContent(e),i=this.$el[0];return _.defer(function(){qazanaFrontend.getScopeWindow().jQuery(i).html(t)}),this},onRender:function(){var e=this,t=e.getEditModel(),i=t.getSetting("_skin")||"default";e.$el.attr("data-element_type",t.get("widgetType")+"."+i).removeClass("qazana-widget-empty").addClass("qazana-widget-"+t.get("widgetType")+" qazana-widget-can-edit").children(".qazana-widget-empty-icon").remove(),e.$el.imagesLoaded().always(function(){setTimeout(function(){1>e.$el.height()&&(e.$el.addClass("qazana-widget-empty"),e.$el.append('<i class="qazana-widget-empty-icon '+t.getIcon()+'"></i>'))},200)}),e.handleElementHover()},handleElementHover:function(){var e=this,t={class:"qazana-widget-settings-active"},i={sensitivity:1,interval:10,timeout:500,over:function(){e.$el.addClass(t.class)},out:function(){e.$el.removeClass(t.class)}};e.$el.hoverIntent(i)}}),t.exports=n},{"qazana-views/base-element":77}],110:[function(e,t,i){"use strict";t.exports=function(){function e(e,t,i,n){var r,o,s;if(l[e][t])if(i)if(r=l[e][t],n)for(s=r.length;s--;)(o=r[s]).callback===i&&o.context===n&&r.splice(s,1);else for(s=r.length;s--;)r[s].callback===i&&r.splice(s,1);else l[e][t]=[]}function t(e){for(var t,i,n,r=1,o=e.length;r<o;r++){for(t=e[r],i=r;(n=e[i-1])&&n.priority>t.priority;)e[i]=e[i-1],--i;e[i]=t}return e}function i(e,i,n,r,o){var s={callback:n,priority:r,context:o},a=l[e][i];a?(a.push(s),a=t(a)):a=[s],l[e][i]=a}function n(e,t,i){var n,r,o=l[e][t];if(!o)return"filters"===e&&i[0];if(r=o.length,"filters"===e)for(n=0;n<r;n++)i[0]=o[n].callback.apply(o[n].context,i);else for(n=0;n<r;n++)o[n].callback.apply(o[n].context,i);return"filters"!==e||i[0]}var r,o=Array.prototype.slice,l={actions:{},filters:{}};return r={removeFilter:function(t,i){return"string"==typeof t&&e("filters",t,i),r},applyFilters:function(){var e=o.call(arguments),t=e.shift();return"string"==typeof t?n("filters",t,e):r},addFilter:function(e,t,n,o){return"string"==typeof e&&"function"==typeof t&&i("filters",e,t,n=parseInt(n||10,10),o),r},removeAction:function(t,i){return"string"==typeof t&&e("actions",t,i),r},doAction:function(){var e=o.call(arguments),t=e.shift();return"string"==typeof t&&n("actions",t,e),r},addAction:function(e,t,n,o){return"string"==typeof e&&"function"==typeof t&&i("actions",e,t,n=parseInt(n||10,10),o),r}}}},{}]},{},[71,72,34]);